<div id="main">
				

	<div class="post">
		
		<div class="postbody"><div id="cnblogs_post_body">
			<p>本地存储中的一个很重要的概念——Web Sql Database ，正因为本人觉得这个很重要，所有独立出来重点介绍。即时你完全没听说过这个概念，望文生义也应该知道它大概是个什么东西。</p><div>Web SQL Database （目前只谷歌浏览器支持）：我把它理解成一个Html5环境下可以用Js执行CRUD的Web数据库。</div><p>对于简单的数据，使用sessionStorage和localStorage能够很好地完成存取，但是对于处理复杂的关系型数据，它就力不从心了。这也是 HTML 5 的“Web SQL Database”API 接口的应用所在。&nbsp;</p><p>下面我将一一将介绍怎样 创建打开数据库，创建表，添加数据，更新数据，删除数据，删除表 。</p><p>&nbsp;</p><p align="left" style="margin-top:2.25pt;text-align:left;background:#F9F9F9"><span style="font-size: 9pt; font-family: 宋体; ">先介绍三个核心方法</span></p>  <p align="left" style="margin-top:2.25pt;text-align:left;background:#F9F9F9"><span style="font-size: 9pt; font-family: Verdana, sans-serif; ">1</span><span style="font-size: 9pt; font-family: 宋体; ">、</span><span style="font-size: 9pt; font-family: Verdana, sans-serif; ">openDatabase</span><span style="font-size: 9pt; font-family: 宋体; ">：这个方法使用现有数据库或创建新数据库创建数据库对象。</span></p>  <p align="left" style="margin-top:2.25pt;text-align:left;background:#F9F9F9"><span style="font-size: 9pt; font-family: Verdana, sans-serif; ">2</span><span style="font-size: 9pt; font-family: 宋体; ">、</span><span style="font-size: 9pt; font-family: Verdana, sans-serif; ">transaction</span><span style="font-size: 9pt; font-family: 宋体; ">：这个方法允许我们根据情况控制事务提交或回滚。</span></p>  <p><span style="font-size: 9pt; font-family: Verdana, sans-serif; ">3</span><span style="font-size: 9pt; font-family: 宋体; ">、</span><span style="font-size: 9pt; font-family: Verdana, sans-serif; ">executeSql</span><span style="font-size: 9pt; font-family: 宋体; ">：这个方法用于执行真实的</span><span style="font-size: 9pt; font-family: Verdana, sans-serif; ">SQL</span><span style="font-size: 9pt; font-family: 宋体; ">查询。</span></p><p>&nbsp;</p><p><strong><span style="font-family: 宋体; ">第一步：打开连接并创建数据库</span>&nbsp;</strong><br></p><div class="cnblogs_code"><div><span style="color: #0000FF;">var</span>&nbsp;dataBase&nbsp;=&nbsp;openDatabase("student",&nbsp;"1.0",&nbsp;"学生表",&nbsp;1024&nbsp;*&nbsp;1024,&nbsp;<span style="color: #0000FF;">function</span>&nbsp;()&nbsp;{&nbsp;});<br><span style="color: #0000FF;">if</span>&nbsp;(!dataBase)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;alert("数据库创建失败！");<br>}&nbsp;<span style="color: #0000FF;">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;alert("数据库创建成功！");<br>}</div></div><p>&nbsp;</p><p>&nbsp;解释一下openDatabase方法打开一个已经存在的数据库，如果数据库不存在，它还可以创建数据库。几个参数意义分别是：</p><div>1，数据库名称。</div><div>2，版本号 目前为1.0,不管他，写死就OK。</div><div>3，对数据库的描述。</div><div>4，设置数据的大小。</div><div>5，回调函数(可省略)。</div><div>初次调用时创建数据库，以后就是建立连接了。</div><div>创建的数据库就存在本地，路径如下：</div><div>C:\Users\Administrator\AppData\Local\Google\Chrome\User Data\Default\databases\http_localhost_4987 。</div><div>创建的是一个sqllite数据库，完全可以用sqllite developer（<a href="http://west263.onlinedown.net:82/down/SqliteDev386.zip" title="点击下载">点击下载</a>） 打开文件，可以看到里面的数据。</div><div></div><p><span style="font-size:10.5pt;font-family:宋体;Times New Roman&quot;; color:#2B2B2B;background:white;"></span></p><p>&nbsp;</p><p><strong><span style="font-size:10.5pt;font-family:宋体;Times New Roman&quot;; color:#2B2B2B;background:white;">第二步：创建数据表</span>&nbsp;</strong></p><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div><div>this.createTable=function() {</div><p>&nbsp; dataBase.transaction(&nbsp;<span style="color: #0000FF;">function</span>(tx)&nbsp;{&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;tx.executeSql(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"create&nbsp;table&nbsp;if&nbsp;not&nbsp;exists&nbsp;stu&nbsp;(id&nbsp;REAL&nbsp;UNIQUE,&nbsp;name&nbsp;TEXT)",&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[],&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000FF;">function</span>(tx,result){&nbsp;alert('创建stu表成功');&nbsp;},&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000FF;">function</span>(tx,&nbsp;error){&nbsp;alert('创建stu表失败:'&nbsp;+&nbsp;error.message);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;});<br>}</p><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div><p>&nbsp;</p><div>解释一下，</div><div>executeSql函数有四个参数，其意义分别是：</div><div>1）表示查询的字符串，使用的SQL语言是SQLite 3.6.19。</div><div>2）插入到查询中问号所在处的字符串数据。</div><div>3）成功时执行的回调函数。返回两个参数：tx和执行的结果。</div><div>4）一个失败时执行的回调函数。返回两个参数：tx和失败的错误信息。</div><p>&nbsp;</p><p><strong><span style="font-family: 宋体; ">第三步：执行增删改查</span>&nbsp;</strong></p><p><span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: #008000; ">1）</span><span style="font-size: 10.5pt; font-family: 宋体; color: #008000; ">添加数据：</span><span style="font-size:10.5pt; font-family:宋体;Times New Roman&quot;;"><br></span></p><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div><div><span style="color: #0000FF;">this</span>.insert&nbsp;=&nbsp;<span style="color: #0000FF;">function</span>&nbsp;()&nbsp;{<br>&nbsp;&nbsp;dataBase.transaction(<span style="color: #0000FF;">function</span>&nbsp;(tx)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tx.executeSql(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"insert&nbsp;&nbsp;into&nbsp;&nbsp;stu&nbsp;(id,&nbsp;name)&nbsp;values(?,&nbsp;?)",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[id,&nbsp;'徐明祥'],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000FF;">function</span>&nbsp;()&nbsp;{&nbsp;alert('添加数据成功');&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000FF;">function</span>&nbsp;(tx,&nbsp;error)&nbsp;{&nbsp;alert('添加数据失败:&nbsp;'&nbsp;+&nbsp;error.message);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;});</div><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div><p>&nbsp;</p><p><span class="Apple-tab-span" style="white-space: pre; ">	</span>&nbsp;</p><p>&nbsp;</p><p>&nbsp; &nbsp; <span style="color: #008000; ">&nbsp;&nbsp;</span><span style="text-align: left; font-size: 9.5pt; font-family: NSimSun; color: #008000; ">2</span><span style="text-align: left; font-size: 9.5pt; font-family: 宋体; color: #008000; ">）查询数据</span></p><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div><div><span style="color: #0000FF;">this</span>.query&nbsp;=&nbsp;<span style="color: #0000FF;">function</span>&nbsp;()&nbsp;{<br>&nbsp;&nbsp;dataBase.transaction(<span style="color: #0000FF;">function</span>&nbsp;(tx)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tx.executeSql(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"select&nbsp;&nbsp;*&nbsp;&nbsp;from&nbsp;&nbsp;stu",&nbsp;[],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000FF;">function</span>&nbsp;(tx,&nbsp;result)&nbsp;{ &nbsp;<span style="color: #339933; ">//</span><span style="color: #339933; ">执行成功的回调函数</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">//</span><span style="color: #008000;">在这里对result&nbsp;做你想要做的事情吧...........</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000FF;">function</span>&nbsp;(tx,&nbsp;error)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert('查询失败:&nbsp;'&nbsp;+&nbsp;error.message);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>}</div><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div><br><div>解释一下</div><div>上面代码中执行成功的回调函数有一参数result。&nbsp;</div><p>result：查询出来的数据集。其数据类型为 SQLResultSet ，就如同C#中的DataTable。&nbsp;</p><div>SQLResultSet 的定义为：</div><div>&nbsp;interface &nbsp;SQLResultSet {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readonly &nbsp;attribute &nbsp;long &nbsp;insertId;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readonly &nbsp;attribute &nbsp;long &nbsp;rowsAffected;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;readonly &nbsp;attribute &nbsp;SQLResultSetRowList &nbsp;rows;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};</div><div>其中最重要的属性—SQLResultSetRowList 类型的 rows 是数据集的“行” 。&nbsp;</div><div>rows 有两个属性：length、item 。</div><div>故，获取查询结果的某一行某一列的值 ：result.rows[i].item[fieldname] &nbsp;。&nbsp;</div><br><div style="text-align: left; ">&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: #008000; ">3）更新数据</span><br><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div><div><span style="color: #0000FF;">this</span>.update&nbsp;=&nbsp;<span style="color: #0000FF;">function</span>&nbsp;(id,&nbsp;name)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;dataBase.transaction(<span style="color: #0000FF;">function</span>&nbsp;(tx)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tx.executeSql(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"update&nbsp;&nbsp;stu&nbsp;&nbsp;set&nbsp;&nbsp;name&nbsp;=&nbsp;&nbsp;?&nbsp;&nbsp;where&nbsp;&nbsp;id=&nbsp;?",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[name,&nbsp;id],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000FF;">function</span>&nbsp;(tx,&nbsp;result)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000FF;">function</span>&nbsp;(tx,&nbsp;error)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert('更新失败:&nbsp;'&nbsp;+&nbsp;error.message);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;});<br>}</div><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div><br>&nbsp; &nbsp;<span style="color: #008000; "> &nbsp; 4）</span><span style="font-size: 9.5pt; font-family: 宋体; color: #008000; ">删除数据</span><span style="font-size: 9.5pt; font-family: 宋体; "><br></span><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div><div>&nbsp; &nbsp;<span style="color: #0000FF;">this</span>.del&nbsp;=&nbsp;<span style="color: #0000FF;">function</span>&nbsp;(id)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataBase.transaction(<span style="color: #0000FF;">function</span>&nbsp;(tx)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tx.executeSql(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"delete&nbsp;&nbsp;from&nbsp;&nbsp;stu&nbsp;&nbsp;where&nbsp;&nbsp;id=&nbsp;?",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[id],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000FF;">function</span>&nbsp;(tx,&nbsp;result)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000FF;">function</span>&nbsp;(tx,&nbsp;error)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert('删除失败:&nbsp;'&nbsp;+&nbsp;error.message);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;}</div><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div><br>&nbsp; &nbsp; &nbsp; <span style="color: #008000; ">&nbsp;5）删除数据表</span><br><div class="cnblogs_code"><div><span style="color: #0000ff; ">&nbsp; this</span>.dropTable&nbsp;=&nbsp;<span style="color: #0000FF;">function</span>&nbsp;()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataBase.transaction(<span style="color: #0000FF;">function</span>&nbsp;(tx)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tx.executeSql('drop&nbsp;&nbsp;table&nbsp;&nbsp;stu');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><br>





			<span style="font-size:9.5pt;font-family:宋体;">我这里附上一个</span>




			<span style="font-size:9.5pt;font-family:NSimSun;"> web sql database </span><span style="font-size:9.5pt; font-family:宋体;">增删改查的</span><span style="font-size:9.5pt;font-family:NSimSun;">demo</span><span style="font-size: 9.5pt; font-family: 宋体; ">，<a title="猛点下载" href="http://files.cnblogs.com/xumingxiang/WebStorage.rar">猛点下载</a>。</span><br>&nbsp;</div><p><span style="font-family: 宋体; ">了解更多：</span><a href="http://www.w3.org/TR/webdatabase/">http://www.w3.org/TR/webdatabase/</a></p><br><div>注：</div><div>1) 查看谷歌浏览器的 “Chrome\User Data\Default ”发现百度、腾讯等好多网站已经在运用localStorage 和 Web Sql Databases 。</div><div>2) localStorage 和 Web Sql DataBase 其实都是在本地创建了一个sqllite 数据库。</div><div>&nbsp; &nbsp; localStorage 是一个简单的数据库，只建了一张表，表名叫 “ItemTable”，并且这个表里只有两个字段 “key”和“Value”。</div><div>&nbsp; &nbsp;而Web Sql DataBase 就是一个完全交给用户去操作的数据库了，复杂或简单完全由用户自己根据需求而决定。&nbsp;</div><p>&nbsp;</p>





</div>

			</div>