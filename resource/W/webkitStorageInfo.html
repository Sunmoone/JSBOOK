<div id="article_content" class="article_content">


<style type="text/css">
<!--
@page
	{margin:2cm}
pre.cjk
	{font-family:"DejaVu Sans",monospace}
p
	{margin-bottom:0.21cm}
h2
	{margin-bottom:0.21cm}
h2.ctl
	{font-family:"Lohit Hindi"}
h3
	{margin-bottom:0.21cm}
h3.ctl
	{font-family:"Lohit Hindi"}
code.cjk
	{font-family:"DejaVu Sans",monospace}
-->
</style>


<h2 class="cjk"><a name="t0"></a>简介</h2>
<p>我常常想，如果网络应用能够读取和写入文件与目录，将会非常方便。从离线转移到在线后，应用变得更加复杂，而文件系统方面的<span style="font-family:DejaVu Serif,serif">API</span>的缺乏也一直阻碍着网络前进。存储二进制数据或与其进行交互不应局限于桌面。令人欣慰的是，由于<span style="font-family:DejaVu Serif,serif"><a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/" target="_blank">FileSystemAPI</a></span>的出现，这一现状终于得到了改变。有了<span style="font-family:DejaVu Serif,serif">FileSystemAPI</span>，网络应用就可以创建、读取、导航用户本地文件系统中的沙盒部分以及向其中写入数据。</p>
<p><span style="font-family:DejaVu Serif,serif">API </span>被分为以下不同的主题：</p>
<ul>
<li>
<p style="margin-bottom:0cm">读取和处理文件：<span style="font-family:DejaVu Serif,serif"><code class="western">File</code>/<code class="western">Blob</code></span>、<span style="font-family:DejaVu Serif,serif"><code class="western">FileList</code></span>、<span style="font-family:DejaVu Serif,serif"><code class="western">FileReader</code></span></p>
</li><li>
<p style="margin-bottom:0cm">创建和写入：<span style="font-family:DejaVu Serif,serif"><code class="western">BlobBuilder</code></span>、<span style="font-family:DejaVu Serif,serif"><code class="western">FileWriter</code></span></p>
</li><li>
<p>目录和文件系统访问：<span style="font-family:DejaVu Serif,serif"><code class="western">DirectoryReader</code></span>、<span style="font-family:DejaVu Serif,serif"><code class="western">FileEntry</code>/<code class="western">DirectoryEntry</code></span>、<span style="font-family:DejaVu Serif,serif"><code class="western">LocalFileSystem</code></span></p>
</li></ul>
<h3 class="cjk"><a name="t1"></a><a name="toc-support"></a>浏览器支持与存储限制</h3>
<p>在写这篇文章时，只有 <span style="font-family:DejaVu Serif,serif">GoogleChrome </span>浏览器可以实施此<span style="font-family:DejaVu Serif,serif">FileSystemAPI</span>。目前尚不存在专门用于文件<span style="font-family:DejaVu Serif,serif">/</span>配额管理的浏览器用户界面。要在用户的系统上存储数据，您的应用可能需要<a href="http://www.html5rocks.com/zh/tutorials/file/filesystem/#toc-requesting-quota">请求配额</a>。不过，可使用<span style="font-family:DejaVu Serif,serif"><code class="western">--unlimited-quota-for-files</code></span>标记运行<span style="font-family:DejaVu Serif,serif">Chrome</span>浏览器进行测试。此外，如果您要开发的是用于<span style="font-family:DejaVu Serif,serif">Chrome</span>网上应用店的应用或扩展程序，可使用<span style="font-family:DejaVu Serif,serif"><code class="western">unlimitedStorage</code></span><a href="http://code.google.com/chrome/extensions/manifest.html" target="_blank">清单文件</a>权限，而无需请求配额。最后，用户会收到授予、拒绝或为应用增加存储的权限对话框。</p>
<p>如果您要通过 <span style="font-family:DejaVu Serif,serif"><code class="western">file://</code></span>调试您的应用，可能需要<span style="font-family:DejaVu Serif,serif"><code class="western">--allow-file-access-from-files</code></span>标记。不使用这些标记会导致<span style="font-family:DejaVu Serif,serif"><code class="western">SECURITY_ERR</code></span>或<span style="font-family:DejaVu Serif,serif"><code class="western">QUOTA_EXCEEDED_ERR</code>FileError</span>。</p>
<h2 class="cjk"><a name="t2"></a><a name="toc-requesting"></a>请求文件系统</h2>
<p>网络应用可通过调用 <span style="font-family:DejaVu Serif,serif"><code class="western">window.requestFileSystem()</code></span>请求对沙盒文件系统的访问权限：</p>
<pre class="cjk" name="code"><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 1052px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_1" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_1" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=1&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>//&nbsp;Note:&nbsp;The&nbsp;file&nbsp;system&nbsp;has&nbsp;been&nbsp;prefixed&nbsp;as&nbsp;of&nbsp;Google&nbsp;Chrome&nbsp;12:&nbsp;&nbsp;</span></span></li><li class=""><span><span class="attribute">window.requestFileSystem</span><span>&nbsp;&nbsp;=&nbsp;</span><span class="attribute-value">window</span><span>.requestFileSystem&nbsp;||&nbsp;window.webkitRequestFileSystem;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>window.requestFileSystem(type,&nbsp;size,&nbsp;successCallback,&nbsp;opt_errorCallback)&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">// Note: The file system has been prefixed as of Google Chrome 12:
window.requestFileSystem  = window.requestFileSystem || window.webkitRequestFileSystem;

window.requestFileSystem(type, size, successCallback, opt_errorCallback)</pre></pre>
<dl><dt><span style="font-family:DejaVu Serif,serif"><var>type</var></span></dt><dd>文件存储是否应该是持久的。可能的值包括<span style="font-family:DejaVu Serif,serif"><code class="western">window.TEMPORARY</code></span>和<span style="font-family:DejaVu Serif,serif"><code class="western">window.PERSISTENT</code></span>。通过<span style="font-family:DejaVu Serif,serif"><code class="western">TEMPORARY</code></span>存储的数据可由浏览器自行决定删除（例如在需要更多空间的情况下）。要清除<span style="font-family:DejaVu Serif,serif"><code class="western">PERSISTENT</code></span>存储，必须获得用户或应用的明确授权，并且需要用户向您的应用授予配额。请参阅<a href="http://www.html5rocks.com/zh/tutorials/file/filesystem/#toc-requesting-quota">请求配额</a>。</dd><dt><span style="font-family:DejaVu Serif,serif"><var>size</var></span></dt><dd>应用需要用于存储的大小（以字节为单位）。</dd><dt><span style="font-family:DejaVu Serif,serif"><var>successCallback</var></span></dt><dd>文件系统请求成功时调用的回调。其参数为 <span style="font-family:DejaVu Serif,serif"><code class="western"><a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/#idl-def-FileSystem" target="_blank">FileSystem</a></code></span>对象。</dd><dt><span style="font-family:DejaVu Serif,serif"><var>opt_errorCallback</var></span></dt><dd style="margin-bottom:0.5cm">用于处理错误或获取文件系统的请求遭到拒绝时可选的回调。其参数为<span style="font-family:DejaVu Serif,serif"><code class="western"><a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/#idl-def-FileError" target="_blank">FileError</a></code></span>对象。</dd></dl>
<p>如果您是首次调用<span style="font-family:DejaVu Serif,serif"><code class="western">requestFileSystem()</code></span>，系统会为您的应用创建新的存储。请注意，这是沙箱文件系统，也就是说，一个网络应用无法访问另一个应用的文件。这也意味着您无法在用户硬盘上的任意文件夹（例如“我的图片”、“我的文档”等）中读<span style="font-family:DejaVu Serif,serif">/</span>写文件。</p>
<p>用法示例：</p>
<pre class="cjk" name="code"><span style="font-family:DejaVu Sans Mono,monospace">function onInitFs(fs) {</span>
  <span style="font-family:DejaVu Sans Mono,monospace">console.log('Opened file system: ' + fs.name);</span>
<span style="font-family:DejaVu Sans Mono,monospace">}</span>

<span style="font-family:DejaVu Sans Mono,monospace">window.requestFileSystem(window.TEMPORARY, 5*1024*1024 /*5MB*/, onInitFs, errorHandler);</span></pre>
<p><span style="font-family:DejaVu Serif,serif">FileSystem </span>规范还定义了计划用于<span style="font-family:DejaVu Serif,serif"><a href="http://www.html5rocks.com/tutorials/#workers">WebWorkers</a></span>的同步<span style="font-family:DejaVu Serif,serif">API(<code class="western"><a href="http://dev.w3.org/2009/dap/file-system/file-dir-sys.html#using-localfilesystemsync" target="_blank">LocalFileSystemSync</a></code>)</span>接口。不过，本教程不涉及该同步<span style="font-family:DejaVu Serif,serif">API</span>。</p>
<p>在本文档的其余部分中，我们将使用相同的处理程序处理异步调用引发的错误：</p>
<pre class="cjk" name="code"><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 1777px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_2" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_2" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=2&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>function&nbsp;errorHandler(e)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;var&nbsp;<span class="attribute">msg</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">''</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;switch&nbsp;(e.code)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;FileError.QUOTA_EXCEEDED_ERR:&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">msg</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">'QUOTA_EXCEEDED_ERR'</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;FileError.NOT_FOUND_ERR:&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">msg</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">'NOT_FOUND_ERR'</span><span>;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;FileError.SECURITY_ERR:&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">msg</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">'SECURITY_ERR'</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;FileError.INVALID_MODIFICATION_ERR:&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">msg</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">'INVALID_MODIFICATION_ERR'</span><span>;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;FileError.INVALID_STATE_ERR:&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">msg</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">'INVALID_STATE_ERR'</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;default:&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">msg</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">'Unknown&nbsp;Error'</span><span>;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;};&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;console.log('Error:&nbsp;'&nbsp;+&nbsp;msg);&nbsp;&nbsp;</span></li><li class=""><span>}&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">function errorHandler(e) {
  var msg = '';

  switch (e.code) {
    case FileError.QUOTA_EXCEEDED_ERR:
      msg = 'QUOTA_EXCEEDED_ERR';
      break;
    case FileError.NOT_FOUND_ERR:
      msg = 'NOT_FOUND_ERR';
      break;
    case FileError.SECURITY_ERR:
      msg = 'SECURITY_ERR';
      break;
    case FileError.INVALID_MODIFICATION_ERR:
      msg = 'INVALID_MODIFICATION_ERR';
      break;
    case FileError.INVALID_STATE_ERR:
      msg = 'INVALID_STATE_ERR';
      break;
    default:
      msg = 'Unknown Error';
      break;
  };

  console.log('Error: ' + msg);
}</pre>当然，这种错误回调非常通用，能让您充分理解，但您提供给用户的应是易于一般人理解的讯息。请求存储配额要使用 <span style="font-family:DejaVu Sans Mono,monospace">PERSISTENT </span>存储，您必须向用户取得存储持久数据的许可。由于浏览器可自行决定删除临时存储的数据，因此这一限制不适用于 <span style="font-family:DejaVu Sans Mono,monospace">TEMPORARY </span>存储。为了将 <span style="font-family:DejaVu Sans Mono,monospace">PERSISTENT </span>存储与 <span style="font-family:DejaVu Sans Mono,monospace">FileSystem API </span>配合使用，<span style="font-family:DejaVu Sans Mono,monospace">Chrome </span>浏览器使用基于 <span style="font-family:DejaVu Sans Mono,monospace">window.webkitStorageInfo </span>的新 <span style="font-family:DejaVu Sans Mono,monospace">API </span>以请求存储：<div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 2392px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_3" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_3" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=3&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>window.webkitStorageInfo.requestQuota(PERSISTENT,&nbsp;1024*1024,&nbsp;function(grantedBytes)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;window.requestFileSystem(PERSISTENT,&nbsp;grantedBytes,&nbsp;onInitFs,&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>},&nbsp;function(e)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;console.log('Error',&nbsp;e);&nbsp;&nbsp;</span></li><li class="alt"><span>});&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">window.webkitStorageInfo.requestQuota(PERSISTENT, 1024*1024, function(grantedBytes) {
  window.requestFileSystem(PERSISTENT, grantedBytes, onInitFs, errorHandler);
}, function(e) {
  console.log('Error', e);
});</pre>用户授予许可后，就不必再调用 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western">requestQuota()</code> </span>了。后续调用为无操作指令。您还可以使用 <span style="font-family:DejaVu Sans Mono,monospace"><a href="https://groups.google.com/a/chromium.org/group/chromium-html5/browse_thread/thread/9be7a2dc04d9af67" target="_blank">API</a> </span>查询源的当前配额使用情况和分配情况：<span style="font-family:DejaVu Sans Mono,monospace"><code class="western">window.webkitStorageInfo.queryUsageAndQuota()</code></span><a name="toc-file"></a>使用文件沙盒环境中的文件通过 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western"><a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/#the-fileentry-interface" target="_blank">FileEntry</a></code> </span>接口表示。<span style="font-family:DejaVu Sans Mono,monospace">FileEntry </span>包含标准文件系统中会有的属性类型（<span style="font-family:DejaVu Sans Mono,monospace"><code class="western">name</code></span>、<span style="font-family:DejaVu Sans Mono,monospace"><code class="western">isFile</code>...</span>）和方法（<span style="font-family:DejaVu Sans Mono,monospace"><code class="western">remove</code></span>、<span style="font-family:DejaVu Sans Mono,monospace"><code class="western">moveTo</code></span>、<span style="font-family:DejaVu Sans Mono,monospace"><code class="western">copyTo</code>...</span>）。<a name="toc-fileentry"></a><span style="font-family:DejaVu Sans Mono,monospace"><code class="western">FileEntry</code> </span>的属性和方法：<div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 2629px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_4" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_4" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=4&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span class="attribute">fileEntry.isFile</span><span>&nbsp;===&nbsp;true&nbsp;&nbsp;</span></span></li><li class=""><span><span class="attribute">fileEntry.isDirectory</span><span>&nbsp;===&nbsp;false&nbsp;&nbsp;</span></span></li><li class="alt"><span>fileEntry.name&nbsp;&nbsp;</span></li><li class=""><span>fileEntry.fullPath&nbsp;&nbsp;</span></li><li class="alt"><span>...&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>fileEntry.getMetadata(successCallback,&nbsp;opt_errorCallback);&nbsp;&nbsp;</span></li><li class=""><span>fileEntry.remove(successCallback,&nbsp;opt_errorCallback);&nbsp;&nbsp;</span></li><li class="alt"><span>fileEntry.moveTo(dirEntry,&nbsp;opt_newName,&nbsp;opt_successCallback,&nbsp;opt_errorCallback);&nbsp;&nbsp;</span></li><li class=""><span>fileEntry.copyTo(dirEntry,&nbsp;opt_newName,&nbsp;opt_successCallback,&nbsp;opt_errorCallback);&nbsp;&nbsp;</span></li><li class="alt"><span>fileEntry.getParent(successCallback,&nbsp;opt_errorCallback);&nbsp;&nbsp;</span></li><li class=""><span>fileEntry.toURL(opt_mimeType);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>fileEntry.file(successCallback,&nbsp;opt_errorCallback);&nbsp;&nbsp;</span></li><li class="alt"><span>fileEntry.createWriter(successCallback,&nbsp;opt_errorCallback);&nbsp;&nbsp;</span></li><li class=""><span>...&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">fileEntry.isFile === true
fileEntry.isDirectory === false
fileEntry.name
fileEntry.fullPath
...

fileEntry.getMetadata(successCallback, opt_errorCallback);
fileEntry.remove(successCallback, opt_errorCallback);
fileEntry.moveTo(dirEntry, opt_newName, opt_successCallback, opt_errorCallback);
fileEntry.copyTo(dirEntry, opt_newName, opt_successCallback, opt_errorCallback);
fileEntry.getParent(successCallback, opt_errorCallback);
fileEntry.toURL(opt_mimeType);

fileEntry.file(successCallback, opt_errorCallback);
fileEntry.createWriter(successCallback, opt_errorCallback);
...</pre>为了更好地理解 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western">FileEntry</code></span>，本部分还提供了执行常规任务的众多技巧。<a name="toc-file-creatingempty"></a>创建文件您可以使用文件系统的 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western">getFile()</code></span>（<span style="font-family:DejaVu Sans Mono,monospace"><a href="http://www.html5rocks.com/zh/tutorials/file/filesystem/#toc-direntry">DirectoryEntry</a> </span>接口的一种方法）查找或创建文件。请求文件系统后，系统会向成功回调传递<span style="font-family:DejaVu Sans Mono,monospace"><code class="western">FileSystem</code> </span>对象，其中包含指向该应用相应文件系统的根的 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western">DirectoryEntry</code> (<code class="western">fs.root</code>)</span>。以下代码会在该应用相应文件系统的根中创建名为“<span style="font-family:DejaVu Sans Mono,monospace">log.txt”</span>的空白文件：<div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 3064px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_5" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_5" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=5&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>function&nbsp;onInitFs(fs)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;fs.root.getFile('log.txt',&nbsp;{create:&nbsp;true,&nbsp;exclusive:&nbsp;true},&nbsp;function(fileEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;<span class="attribute">fileEntry.isFile</span><span>&nbsp;===&nbsp;true&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;<span class="attribute">fileEntry.name</span><span>&nbsp;==&nbsp;'log.txt'&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;<span class="attribute">fileEntry.fullPath</span><span>&nbsp;==&nbsp;'/log.txt'&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;onInitFs,&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">function onInitFs(fs) {

  fs.root.getFile('log.txt', {create: true, exclusive: true}, function(fileEntry) {

    // fileEntry.isFile === true
    // fileEntry.name == 'log.txt'
    // fileEntry.fullPath == '/log.txt'

  }, errorHandler);

}

window.requestFileSystem(window.TEMPORARY, 1024*1024, onInitFs, errorHandler);</pre>请求文件系统后，系统会向成功处理程序传递 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western">FileSystem</code> </span>对象。我们可以将回调中的 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western">fs.root.getFile()</code> </span>命名为要创建的文件的文件名。您可以传递绝对路径或相对路径，但该路径必须有效。例如，如果您尝试创建一个其直接父级文件不存在的文件，将会导致出错。<span style="font-family:DejaVu Sans Mono,monospace"><code class="western">getFile()</code> </span>的第二个参数是在文件不存在时从字面上说明函数行为的对象。在此示例中，<span style="font-family:DejaVu Sans Mono,monospace"><code class="western">create: true</code> </span>会在文件不存在时创建文件，并在文件存在时 <span style="font-family:DejaVu Sans Mono,monospace">(<code class="western">exclusive: true</code>) </span>引发错误。如果 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western">create: false</code></span>，系统只会获取并返回文件。无论是哪种情况，系统都不会覆盖文件内容，因为我们只是获取相关文件的引用路径。<a name="toc-file-readingbyname"></a>通过名称读取文件以下代码会检索名为“<span style="font-family:DejaVu Sans Mono,monospace">log.txt”</span>的文件，并使用 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western">FileReader</code> API </span>读取文件内容，然后将其附加到页面上新的 <span style="font-family:DejaVu Sans Mono,monospace">&lt;textarea&gt;</span>。如果 <span style="font-family:DejaVu Sans Mono,monospace">log.txt </span>不存在，系统将引发错误。<div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 3523px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_6" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_6" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=6&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>function&nbsp;onInitFs(fs)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;fs.root.getFile('log.txt',&nbsp;{},&nbsp;function(fileEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Get&nbsp;a&nbsp;File&nbsp;object&nbsp;representing&nbsp;the&nbsp;file,&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;then&nbsp;use&nbsp;FileReader&nbsp;to&nbsp;read&nbsp;its&nbsp;contents.&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;fileEntry.file(function(file)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;<span class="attribute">reader</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">new</span><span>&nbsp;FileReader();&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">reader.onloadend</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">function</span><span>(e)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;<span class="attribute">txtArea</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">document</span><span>.createElement('textarea');&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">txtArea.value</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">this</span><span>.result;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.body.appendChild(txtArea);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reader.readAsText(file);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;onInitFs,&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">function onInitFs(fs) {

  fs.root.getFile('log.txt', {}, function(fileEntry) {

    // Get a File object representing the file,
    // then use FileReader to read its contents.
    fileEntry.file(function(file) {
       var reader = new FileReader();

       reader.onloadend = function(e) {
         var txtArea = document.createElement('textarea');
         txtArea.value = this.result;
         document.body.appendChild(txtArea);
       };

       reader.readAsText(file);
    }, errorHandler);

  }, errorHandler);

}

window.requestFileSystem(window.TEMPORARY, 1024*1024, onInitFs, errorHandler);</pre><a name="toc-file-writing"></a>写入到文件以下代码会创建名为“<span style="font-family:DejaVu Sans Mono,monospace">log.txt”</span>的空白文件（如果该文件不存在），并在文件中填入“<span style="font-family:DejaVu Sans Mono,monospace">Lorem Ipsum”</span>文字。<div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 4032px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_7" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_7" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=7&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>function&nbsp;onInitFs(fs)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;fs.root.getFile('log.txt',&nbsp;{create:&nbsp;true},&nbsp;function(fileEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;FileWriter&nbsp;object&nbsp;for&nbsp;our&nbsp;FileEntry&nbsp;(log.txt).&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;fileEntry.createWriter(function(fileWriter)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">fileWriter.onwriteend</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">function</span><span>(e)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('Write&nbsp;completed.');&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">fileWriter.onerror</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">function</span><span>(e)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('Write&nbsp;failed:&nbsp;'&nbsp;+&nbsp;e.toString());&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;new&nbsp;Blob&nbsp;and&nbsp;write&nbsp;it&nbsp;to&nbsp;log.txt.&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;<span class="attribute">bb</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">new</span><span>&nbsp;BlobBuilder();&nbsp;//&nbsp;Note:&nbsp;window.WebKitBlobBuilder&nbsp;in&nbsp;Chrome&nbsp;12.&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bb.append('Lorem&nbsp;Ipsum');&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fileWriter.write(bb.getBlob('text/plain'));&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;onInitFs,&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">function onInitFs(fs) {

  fs.root.getFile('log.txt', {create: true}, function(fileEntry) {

    // Create a FileWriter object for our FileEntry (log.txt).
    fileEntry.createWriter(function(fileWriter) {

      fileWriter.onwriteend = function(e) {
        console.log('Write completed.');
      };

      fileWriter.onerror = function(e) {
        console.log('Write failed: ' + e.toString());
      };

      // Create a new Blob and write it to log.txt.
      var bb = new BlobBuilder(); // Note: window.WebKitBlobBuilder in Chrome 12.
      bb.append('Lorem Ipsum');
      fileWriter.write(bb.getBlob('text/plain'));

    }, errorHandler);

  }, errorHandler);

}

window.requestFileSystem(window.TEMPORARY, 1024*1024, onInitFs, errorHandler);</pre>此时，我们会调用 <span style="font-family:DejaVu Sans Mono,monospace">FileEntry </span>的 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western">createWriter()</code> </span>方法获取 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western">FileWriter</code> </span>对象。在成功回调中为<span style="font-family:DejaVu Sans Mono,monospace"><code class="western">error</code> </span>事件和 <span style="font-family:DejaVu Sans Mono,monospace"><code class="western">writeend</code> </span>事件设置事件处理程序。通过以下操作将文字数据写入文件：创建 <span style="font-family:DejaVu Sans Mono,monospace">Blob</span>，向 <span style="font-family:DejaVu Sans Mono,monospace">Blob </span>附加文字，然后将 <span style="font-family:DejaVu Sans Mono,monospace">Blob </span>传递到<span style="font-family:DejaVu Sans Mono,monospace"><code class="western">FileWriter.write()</code></span>。<a name="toc-file-appending"></a>向文件附加文字以下代码会将“<span style="font-family:DejaVu Sans Mono,monospace">Hello World”</span>文字附加到日志文件结尾。如果该文件不存在，系统将引发错误。<div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 4665px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_8" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_8" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=8&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>function&nbsp;onInitFs(fs)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;fs.root.getFile('log.txt',&nbsp;{create:&nbsp;false},&nbsp;function(fileEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;FileWriter&nbsp;object&nbsp;for&nbsp;our&nbsp;FileEntry&nbsp;(log.txt).&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;fileEntry.createWriter(function(fileWriter)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fileWriter.seek(fileWriter.length);&nbsp;//&nbsp;Start&nbsp;write&nbsp;position&nbsp;at&nbsp;EOF.&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;new&nbsp;Blob&nbsp;and&nbsp;write&nbsp;it&nbsp;to&nbsp;log.txt.&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;<span class="attribute">bb</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">new</span><span>&nbsp;BlobBuilder();&nbsp;//&nbsp;Note:&nbsp;window.WebKitBlobBuilder&nbsp;in&nbsp;Chrome&nbsp;12.&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bb.append('Hello&nbsp;World');&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fileWriter.write(bb.getBlob('text/plain'));&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;onInitFs,&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">function onInitFs(fs) {

  fs.root.getFile('log.txt', {create: false}, function(fileEntry) {

    // Create a FileWriter object for our FileEntry (log.txt).
    fileEntry.createWriter(function(fileWriter) {

      fileWriter.seek(fileWriter.length); // Start write position at EOF.

      // Create a new Blob and write it to log.txt.
      var bb = new BlobBuilder(); // Note: window.WebKitBlobBuilder in Chrome 12.
      bb.append('Hello World');
      fileWriter.write(bb.getBlob('text/plain'));

    }, errorHandler);

  }, errorHandler);

}

window.requestFileSystem(window.TEMPORARY, 1024*1024, onInitFs, errorHandler);</pre><br><h3 id="toc-file-user-selected"><a name="t3"></a>复制用户选定的文件</h3><p>以下代码可让用户使用 <code>&lt;input type="file" multiple /&gt;</code> 选择多个文件，并在应用的沙盒文件系统中复制这些文件。</p><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 5198px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_9" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_9" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=9&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span class="tag">&lt;</span><span class="tag-name">input</span><span>&nbsp;</span><span class="attribute">type</span><span>=</span><span class="attribute-value">"file"</span><span>&nbsp;</span><span class="attribute">id</span><span>=</span><span class="attribute-value">"myfile"</span><span>&nbsp;multiple&nbsp;</span><span class="tag">/&gt;</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>document.querySelector('#myfile')<span class="attribute">.onchange</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">function</span><span>(e)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;var&nbsp;<span class="attribute">files</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">this</span><span>.files;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;function(fs)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Duplicate&nbsp;each&nbsp;file&nbsp;the&nbsp;user&nbsp;selected&nbsp;to&nbsp;the&nbsp;app's&nbsp;fs.&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(var&nbsp;<span class="attribute">i</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">0</span><span>,&nbsp;file;&nbsp;</span><span class="attribute">file</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">files</span><span>[i];&nbsp;++i)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Capture&nbsp;current&nbsp;iteration's&nbsp;file&nbsp;in&nbsp;local&nbsp;scope&nbsp;for&nbsp;the&nbsp;getFile()&nbsp;callback.&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(function(f)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fs.root.getFile(file.name,&nbsp;{create:&nbsp;true,&nbsp;exclusive:&nbsp;true},&nbsp;function(fileEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fileEntry.createWriter(function(fileWriter)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fileWriter.write(f);&nbsp;//&nbsp;Note:&nbsp;write()&nbsp;can&nbsp;take&nbsp;a&nbsp;File&nbsp;or&nbsp;Blob&nbsp;object.&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})(file);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>};&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">&lt;input type="file" id="myfile" multiple /&gt;

document.querySelector('#myfile').onchange = function(e) {
  var files = this.files;

  window.requestFileSystem(window.TEMPORARY, 1024*1024, function(fs) {
    // Duplicate each file the user selected to the app's fs.
    for (var i = 0, file; file = files[i]; ++i) {

      // Capture current iteration's file in local scope for the getFile() callback.
      (function(f) {
        fs.root.getFile(file.name, {create: true, exclusive: true}, function(fileEntry) {
          fileEntry.createWriter(function(fileWriter) {
            fileWriter.write(f); // Note: write() can take a File or Blob object.
          }, errorHandler);
        }, errorHandler);
      })(file);

    }
  }, errorHandler);

};
</pre><p>虽然我们通过输入导入文件，您也可以使用 <a href="http://www.html5rocks.com/tutorials/dnd/basics/#toc-desktop-dnd-into">HTML5 拖放</a>功能轻松实现相同的目标。</p><p>正如评论中所说的，<code>FileWriter.write()</code> 可接受 <code>Blob</code> 或 <code>File</code>。这是因为 <code>File</code> 继承自 <code>Blob</code>，所以文件对象也是 Blob。</p><h3 id="toc-file-removing"><a name="t4"></a>删除文件</h3><p>以下代码会删除“log.txt”文件。</p><pre class="prettyprint" name="code"><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 5791px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_10" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_10" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=10&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;function(fs)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;fs.root.getFile('log.txt',&nbsp;{create:&nbsp;false},&nbsp;function(fileEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;fileEntry.remove(function()&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('File&nbsp;removed.');&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>},&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">window.requestFileSystem(window.TEMPORARY, 1024*1024, function(fs) {
  fs.root.getFile('log.txt', {create: false}, function(fileEntry) {

    fileEntry.remove(function() {
      console.log('File removed.');
    }, errorHandler);

  }, errorHandler);
}, errorHandler);</pre></pre><h2 id="toc-dir"><a name="t5"></a>使用目录</h2><p>沙盒中的目录通过 <a target="_blank" href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/#the-directoryentry-interface"><code>DirectoryEntry</code></a> 接口表示，该接口共享了 <a href="http://www.html5rocks.com/zh/tutorials/file/filesystem/#toc-fileentry">FileEntry</a> 的大部分属性（继承自常用 <code>Entry</code> 接口）。不过，<code>DirectoryEntry</code> 还可使用其他方法处理目录。</p><p><code>DirectoryEntry</code> 的属性和方法：</p><pre class="prettyprint" name="code"><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 6142px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_11" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_11" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=11&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span class="attribute">dirEntry.isDirectory</span><span>&nbsp;===&nbsp;true&nbsp;&nbsp;</span></span></li><li class=""><span>//&nbsp;See&nbsp;the&nbsp;section&nbsp;on&nbsp;FileEntry&nbsp;for&nbsp;other&nbsp;inherited&nbsp;properties/methods.&nbsp;&nbsp;</span></li><li class="alt"><span>...&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>var&nbsp;<span class="attribute">dirReader</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">dirEntry</span><span>.createReader();&nbsp;&nbsp;</span></span></li><li class=""><span>dirEntry.getFile(path,&nbsp;opt_flags,&nbsp;opt_successCallback,&nbsp;opt_errorCallback);&nbsp;&nbsp;</span></li><li class="alt"><span>dirEntry.getDirectory(path,&nbsp;opt_flags,&nbsp;opt_successCallback,&nbsp;opt_errorCallback);&nbsp;&nbsp;</span></li><li class=""><span>dirEntry.removeRecursively(successCallback,&nbsp;opt_errorCallback);&nbsp;&nbsp;</span></li><li class="alt"><span>...&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">dirEntry.isDirectory === true
// See the section on FileEntry for other inherited properties/methods.
...

var dirReader = dirEntry.createReader();
dirEntry.getFile(path, opt_flags, opt_successCallback, opt_errorCallback);
dirEntry.getDirectory(path, opt_flags, opt_successCallback, opt_errorCallback);
dirEntry.removeRecursively(successCallback, opt_errorCallback);
...
</pre><br></pre><h3 id="toc-dir-creating"><a name="t6"></a>创建目录</h3><p>使用 <code>DirectoryEntry</code> 的 <code>getDirectory()</code> 方法读取或创建目录。您可以递交名称或路径作为查找或创建所用的目录。</p><p>例如，以下代码会在根目录中创建名为“MyPictures”的目录：</p><pre class="prettyprint" name="code"><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 6507px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_12" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_12" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=12&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;function(fs)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;fs.root.getDirectory('MyPictures',&nbsp;{create:&nbsp;true},&nbsp;function(dirEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>},&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">window.requestFileSystem(window.TEMPORARY, 1024*1024, function(fs) {
  fs.root.getDirectory('MyPictures', {create: true}, function(dirEntry) {
    ...
  }, errorHandler);
}, errorHandler);</pre><br></pre><h3 id="toc-dir-subirs"><a name="t7"></a>子目录</h3><p>创建子目录的方法与创建其他任何目录的方法完全相同。不过，如果您尝试创建其直接父目录不存在的目录，API 将引发错误。相应的解决方法是，依次创建各级目录，而这对异步 API 而言非常麻烦。</p><p>以下代码会在系统创建父文件夹后以递归方式添加各个子文件夹，从而在应用相应 FileSystem 的根中创建新的层次结构 (music/genres/jazz)。</p><pre class="prettyprint" name="code"><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 6825px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_13" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_13" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=13&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>var&nbsp;</span><span class="attribute">path</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">'music/genres/jazz/'</span><span>;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>function&nbsp;createDir(rootDirEntry,&nbsp;folders)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;//&nbsp;Throw&nbsp;out&nbsp;'./'&nbsp;or&nbsp;'/'&nbsp;and&nbsp;move&nbsp;on&nbsp;to&nbsp;prevent&nbsp;something&nbsp;like&nbsp;'/foo/.//bar'.&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;if&nbsp;(folders[0]&nbsp;==&nbsp;'.'&nbsp;||&nbsp;folders[0]&nbsp;==&nbsp;'')&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">folders</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">folders</span><span>.slice(1);&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;rootDirEntry.getDirectory(folders[0],&nbsp;{create:&nbsp;true},&nbsp;function(dirEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Recursively&nbsp;add&nbsp;the&nbsp;new&nbsp;subfolder&nbsp;(if&nbsp;we&nbsp;still&nbsp;have&nbsp;another&nbsp;to&nbsp;create).&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(folders.length)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;createDir(dirEntry,&nbsp;folders.slice(1));&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class=""><span>};&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>function&nbsp;onInitFs(fs)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;createDir(fs.root,&nbsp;path.split('/'));&nbsp;//&nbsp;fs.root&nbsp;is&nbsp;a&nbsp;DirectoryEntry.&nbsp;&nbsp;</span></li><li class=""><span>}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;onInitFs,&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">var path = 'music/genres/jazz/';

function createDir(rootDirEntry, folders) {
  // Throw out './' or '/' and move on to prevent something like '/foo/.//bar'.
  if (folders[0] == '.' || folders[0] == '') {
    folders = folders.slice(1);
  }
  rootDirEntry.getDirectory(folders[0], {create: true}, function(dirEntry) {
    // Recursively add the new subfolder (if we still have another to create).
    if (folders.length) {
      createDir(dirEntry, folders.slice(1));
    }
  }, errorHandler);
};

function onInitFs(fs) {
  createDir(fs.root, path.split('/')); // fs.root is a DirectoryEntry.
}

window.requestFileSystem(window.TEMPORARY, 1024*1024, onInitFs, errorHandler);</pre></pre><p>在“music/genres/jazz”处于合适的位置后，我们就可以将完整路径传递到 <code>getDirectory()</code>，然后在其下方创建新的子文件夹。例如：</p><pre class="prettyprint" name="code">window.requestFileSystem(window.TEMPORARY, 1024*1024, function(fs) {
  fs.root.getFile('/music/genres/jazz/song.mp3', {create: true}, function(fileEntry) {
    ...
  }, errorHandler);
}, errorHandler);
</pre><h3 id="toc-dir-reading"><a name="t8"></a>读取目录内容</h3><p>要读取目录的内容，可先创建 <code>DirectoryReader</code>，然后调用 <code>readEntries()</code> 方法。我们不能保证所有目录条目都能在仅调用一次 <code>readEntries()</code> 的情况下同时返回。也就是说，您需要一直调用 <code>DirectoryReader.readEntries()</code>，直到系统不再返回结果为止。以下代码对此作了说明：</p><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 7524px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_14" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_14" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=14&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span class="tag">&lt;</span><span class="tag-name">ul</span><span>&nbsp;</span><span class="attribute">id</span><span>=</span><span class="attribute-value">"filelist"</span><span class="tag">&gt;</span><span class="tag">&lt;/</span><span class="tag-name">ul</span><span class="tag">&gt;</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>function&nbsp;toArray(list)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;return&nbsp;Array.prototype.slice.call(list&nbsp;||&nbsp;[],&nbsp;0);&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>function&nbsp;listResults(entries)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;//&nbsp;Document&nbsp;fragments&nbsp;can&nbsp;improve&nbsp;performance&nbsp;since&nbsp;they're&nbsp;only&nbsp;appended&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;//&nbsp;to&nbsp;the&nbsp;DOM&nbsp;once.&nbsp;Only&nbsp;one&nbsp;browser&nbsp;reflow&nbsp;occurs.&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;var&nbsp;<span class="attribute">fragment</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">document</span><span>.createDocumentFragment();&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;entries.forEach(function(entry,&nbsp;i)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;<span class="attribute">img</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">entry</span><span>.isDirectory&nbsp;?&nbsp;'</span><span class="tag">&lt;</span><span class="tag-name">img</span><span>&nbsp;</span><span class="attribute">src</span><span>=</span><span class="attribute-value">"folder-icon.gif"</span><span class="tag">&gt;</span><span>'&nbsp;:&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'<span class="tag">&lt;</span><span class="tag-name">img</span><span>&nbsp;</span><span class="attribute">src</span><span>=</span><span class="attribute-value">"file-icon.gif"</span><span class="tag">&gt;</span><span>';&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;<span class="attribute">li</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">document</span><span>.createElement('li');&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">li.innerHTML</span><span>&nbsp;=&nbsp;[img,&nbsp;'</span><span class="tag">&lt;</span><span class="tag-name">span</span><span class="tag">&gt;</span><span>',&nbsp;entry.name,&nbsp;'</span><span class="tag">&lt;/</span><span class="tag-name">span</span><span class="tag">&gt;</span><span>'].join('');&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;fragment.appendChild(li);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;});&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;document.querySelector('#filelist').appendChild(fragment);&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>function&nbsp;onInitFs(fs)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;var&nbsp;<span class="attribute">dirReader</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">fs</span><span>.root.createReader();&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;var&nbsp;<span class="attribute">entries</span><span>&nbsp;=&nbsp;[];&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;//&nbsp;Call&nbsp;the&nbsp;reader.readEntries()&nbsp;until&nbsp;no&nbsp;more&nbsp;results&nbsp;are&nbsp;returned.&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;var&nbsp;<span class="attribute">readEntries</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">function</span><span>()&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dirReader.readEntries&nbsp;(function(results)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!results.length)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listResults(entries.sort());&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute">entries</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">entries</span><span>.concat(toArray(results));&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readEntries();&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;};&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;readEntries();&nbsp;//&nbsp;Start&nbsp;reading&nbsp;dirs.&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;onInitFs,&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">&lt;ul id="filelist"&gt;&lt;/ul&gt;

function toArray(list) {
  return Array.prototype.slice.call(list || [], 0);
}

function listResults(entries) {
  // Document fragments can improve performance since they're only appended
  // to the DOM once. Only one browser reflow occurs.
  var fragment = document.createDocumentFragment();

  entries.forEach(function(entry, i) {
    var img = entry.isDirectory ? '&lt;img src="folder-icon.gif"&gt;' :
                                  '&lt;img src="file-icon.gif"&gt;';
    var li = document.createElement('li');
    li.innerHTML = [img, '&lt;span&gt;', entry.name, '&lt;/span&gt;'].join('');
    fragment.appendChild(li);
  });

  document.querySelector('#filelist').appendChild(fragment);
}

function onInitFs(fs) {

  var dirReader = fs.root.createReader();
  var entries = [];

  // Call the reader.readEntries() until no more results are returned.
  var readEntries = function() {
     dirReader.readEntries (function(results) {
      if (!results.length) {
        listResults(entries.sort());
      } else {
        entries = entries.concat(toArray(results));
        readEntries();
      }
    }, errorHandler);
  };

  readEntries(); // Start reading dirs.

}

window.requestFileSystem(window.TEMPORARY, 1024*1024, onInitFs, errorHandler);
</pre><h3 id="toc-dir-removing"><a name="t9"></a>删除目录</h3><p><code>DirectoryEntry.remove()</code> 方法的行为与 <a href="http://www.html5rocks.com/zh/tutorials/file/filesystem/#toc-file-removing"><code>FileEntry</code></a> 相应方法的行为非常相似。差别在于：尝试删除非空目录时会引发错误。</p><p>以下代码会从“/music/genres/”删除空的“jazz”目录：</p><pre class="prettyprint" name="code"><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 8479px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_15" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_15" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=15&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;function(fs)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;fs.root.getDirectory('music/genres/jazz',&nbsp;{},&nbsp;function(dirEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;dirEntry.remove(function()&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('Directory&nbsp;removed.');&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>},&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">window.requestFileSystem(window.TEMPORARY, 1024*1024, function(fs) {
  fs.root.getDirectory('music/genres/jazz', {}, function(dirEntry) {

    dirEntry.remove(function() {
      console.log('Directory removed.');
    }, errorHandler);

  }, errorHandler);
}, errorHandler);
</pre></pre><h4 id="toc-dir-rremoving"><a name="t10"></a>以递归方式删除目录</h4><p>如果您不需要某个包含条目的目录，不妨使用 <code>removeRecursively()</code>。该方法将以递归方式删除目录及其内容。</p><p>以下代码会以递归方式删除“music”目录及其包含的所有文件和目录：</p><pre class="prettyprint" name="code"><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 8796px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_16" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_16" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=16&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;function(fs)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;fs.root.getDirectory('/misc/../music',&nbsp;{},&nbsp;function(dirEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;dirEntry.removeRecursively(function()&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('Directory&nbsp;removed.');&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>},&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">window.requestFileSystem(window.TEMPORARY, 1024*1024, function(fs) {
  fs.root.getDirectory('/misc/../music', {}, function(dirEntry) {

    dirEntry.removeRecursively(function() {
      console.log('Directory removed.');
    }, errorHandler);

  }, errorHandler);
}, errorHandler);</pre></pre><h2 id="toc-copy-rename-move"><a name="t11"></a>复制、重命名和移动</h2><p><code>FileEntry</code> 和 <code>DirectoryEntry</code> 享有共同的操作。</p><h3 id="toc-dir-move-copy"><a name="t12"></a>复制条目</h3><p><code>FileEntry</code> 和 <code>DirectoryEntry</code> 均可使用 <code>copyTo()</code> 复制现有条目。该方法会自动以递归方式复制文件夹。</p><p>以下代码示例会将“me.png”文件从一个目录复制到另一个目录：</p><pre class="prettyprint" name="code"><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 9189px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_17" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_17" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=17&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>function&nbsp;copy(cwd,&nbsp;src,&nbsp;dest)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;cwd.getFile(src,&nbsp;{},&nbsp;function(fileEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;cwd.getDirectory(dest,&nbsp;{},&nbsp;function(dirEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fileEntry.copyTo(dirEntry);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;function(fs)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;copy(fs.root,&nbsp;'/folder1/me.png',&nbsp;'folder2/mypics/');&nbsp;&nbsp;</span></li><li class="alt"><span>},&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">function copy(cwd, src, dest) {
  cwd.getFile(src, {}, function(fileEntry) {

    cwd.getDirectory(dest, {}, function(dirEntry) {
      fileEntry.copyTo(dirEntry);
    }, errorHandler);

  }, errorHandler);
}

window.requestFileSystem(window.TEMPORARY, 1024*1024, function(fs) {
  copy(fs.root, '/folder1/me.png', 'folder2/mypics/');
}, errorHandler);
</pre></pre><h3 id="toc-dir-move-rename"><a name="t13"></a>移动或重命名条目</h3><p><code>FileEntry</code> 和 <code>DirectoryEntry</code> 的 <code>moveTo()</code> 方法可让您移动或重命名文件或目录。其第一个参数是文件要移动到的目标父目录，其第二个参数是文件可选的新名称。如未提供新名称，系统将使用文件的原名称。</p><p>以下示例将“me.png”重命名为“you.png”，但并不移动该文件：</p><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 9612px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_18" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_18" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=18&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>function&nbsp;rename(cwd,&nbsp;src,&nbsp;newName)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;cwd.getFile(src,&nbsp;{},&nbsp;function(fileEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;fileEntry.moveTo(cwd,&nbsp;newName);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;function(fs)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;rename(fs.root,&nbsp;'me.png',&nbsp;'you.png');&nbsp;&nbsp;</span></li><li class="alt"><span>},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>以下示例将“me.png”（位于根目录中）移动到名为“newfolder”的文件夹。&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>function&nbsp;move(src,&nbsp;dirName)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;fs.root.getFile(src,&nbsp;{},&nbsp;function(fileEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;fs.root.getDirectory(dirName,&nbsp;{},&nbsp;function(dirEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fileEntry.moveTo(dirEntry);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;},&nbsp;errorHandler);&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>window.requestFileSystem(window.TEMPORARY,&nbsp;1024*1024,&nbsp;function(fs)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;move('/me.png',&nbsp;'newfolder/');&nbsp;&nbsp;</span></li><li class="alt"><span>},&nbsp;errorHandler);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">function rename(cwd, src, newName) {
  cwd.getFile(src, {}, function(fileEntry) {
    fileEntry.moveTo(cwd, newName);
  }, errorHandler);
}

window.requestFileSystem(window.TEMPORARY, 1024*1024, function(fs) {
  rename(fs.root, 'me.png', 'you.png');
}, errorHandler);

以下示例将“me.png”（位于根目录中）移动到名为“newfolder”的文件夹。

function move(src, dirName) {
  fs.root.getFile(src, {}, function(fileEntry) {

    fs.root.getDirectory(dirName, {}, function(dirEntry) {
      fileEntry.moveTo(dirEntry);
    }, errorHandler);

  }, errorHandler);
}

window.requestFileSystem(window.TEMPORARY, 1024*1024, function(fs) {
  move('/me.png', 'newfolder/');
}, errorHandler);
</pre><h2 id="toc-filesystemurls"><a name="t14"></a>filesystem: 网址</h2>FileSystem API 使用新的网址机制，（即 filesystem:），可用于填充 src 或 href 属性。例如，如果您要显示某幅图片且拥有相应的 fileEntry，您可以调用 toURL() 获取该文件的 filesystem: 网址：<br><br><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 10243px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_19" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_19" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=19&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>var&nbsp;</span><span class="attribute">img</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">document</span><span>.createElement('img');&nbsp;&nbsp;</span></span></li><li class=""><span><span class="attribute">img.src</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">fileEntry</span><span>.toURL();&nbsp;//&nbsp;filesystem:http://example.com/temporary/myfile.png&nbsp;&nbsp;</span></span></li><li class="alt"><span>document.body.appendChild(img);&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">var img = document.createElement('img');
img.src = fileEntry.toURL(); // filesystem:http://example.com/temporary/myfile.png
document.body.appendChild(img);</pre><br>另外，如果您已具备 filesystem: 网址，可使用 resolveLocalFileSystemURL() 找回 fileEntry：<br><br><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 10444px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_20" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_20" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=20&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span class="attribute">window.resolveLocalFileSystemURL</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">window</span><span>.resolveLocalFileSystemURL&nbsp;||&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.webkitResolveLocalFileSystemURL;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>var&nbsp;<span class="attribute">url</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">'filesystem:http://example.com/temporary/myfile.png'</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>window.resolveLocalFileSystemURL(url,&nbsp;function(fileEntry)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;...&nbsp;&nbsp;</span></li><li class="alt"><span>});&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">window.resolveLocalFileSystemURL = window.resolveLocalFileSystemURL ||
                                   window.webkitResolveLocalFileSystemURL;

var url = 'filesystem:http://example.com/temporary/myfile.png';
window.resolveLocalFileSystemURL(url, function(fileEntry) {
  ...
});</pre></pre>
<h2><a name="t15"></a>支持的浏览器：</h2>
<pre class="cjk" name="code">Opera仅支持FileAPI &nbsp;IE不支持 &nbsp; Safari不支持 &nbsp; Firefox仅支持FileAPI &nbsp; Chrome/Chromium浏览器支持。<span style="font-size:18px"><strong>
</strong></span><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 380px; top: 10706px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_21" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_21" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=21&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span class="tag">&lt;</span><span class="tag-name">span</span><span>&nbsp;</span><span class="attribute">class</span><span>=</span><span class="attribute-value">"browsers"</span><span class="tag">&gt;</span><span class="tag">&lt;/</span><span class="tag-name">span</span><span class="tag">&gt;</span><span>&nbsp;&nbsp;</span></span></li></ol></div><pre name="code" class="html" style="display: none;"><span class="browsers"></span></pre><pre></pre><pre></pre></pre>

</div>