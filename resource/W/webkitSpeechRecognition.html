<div id="article_details" class="details">
    <div class="article_title">
    <span class="ico ico_type_Original"></span>
    <h3>
        <span class="link_title"><a href="/hfahe/article/details/8511238">
        激动人心！在网页上通过语音输入文字 - HTML5 Web Speech API介绍
        </a></span>
    </h3>
</div>

    <div class="article_manage">
        <span class="link_categories">
        分类：
            <a href="/hfahe/article/category/724858">前端</a> 
            <a href="/hfahe/article/category/792735">应用开发</a> 
            <a href="/hfahe/article/category/787305">移动开发</a> 
        </span>
    <span class="link_postdate">2013-01-16 22:39</span>
    <span class="link_view" title="阅读次数">3945人阅读</span>
    <span class="link_comments" title="评论次数"><a href="#comments" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_pinglun'])">评论</a>(2)</span>
    <span class="link_collect"><a href="javascript:void(0);" onclick="javascript:_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_shoucang']);collectArticle('激动人心！在网页上通过语音输入文字 - HTML5 Web Speech API介绍','8511238');return false;" title="收藏">收藏</a></span>
    <span class="link_report"><a href="#report" onclick="javascript:_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_jubao']);report(8511238,2);return false;" title="举报">举报</a></span>
    
</div>

    
<div id="article_content" class="article_content">
<p><span style="color:rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:rgb(34, 34, 34);">很久前我曾经</span><a href="http://blog.csdn.net/hfahe/article/details/7338032">提到</a><span style="color:rgb(34, 34, 34);">过</span><a href="https://dvcs.w3.org/hg/speech-api/raw-file/tip/speechapi.html"><strong>Web Speech API</strong></a><span style="color:rgb(34, 34, 34);">，现在</span><span style="color:rgb(34, 34, 34);">Chrome</span><span style="color:rgb(34, 34, 34);">刚刚发布的</span><span style="color:rgb(34, 34, 34);">25</span><span style="color:rgb(34, 34, 34);">版本已经为桌面和</span><span style="color:rgb(34, 34, 34);">Android</span><span style="color:rgb(34, 34, 34);">提供了对此</span><span style="color:rgb(34, 34, 34);">API</span><span style="color:rgb(34, 34, 34);">的支持，这对</span><span style="color:rgb(34, 34, 34);">Web</span><span style="color:rgb(34, 34, 34);">开发者来说无疑是一个具有里程碑意义的事件，因为我们可以直接在</span><span style="color:rgb(34, 34, 34);">Web App</span><span style="color:rgb(34, 34, 34);">中原生使用语音识别技术，</span><span style="color:rgb(34, 34, 34);">Web</span><span style="color:rgb(34, 34, 34);">应用的新时代将会由此开启。</span></p><p><span style="color:rgb(34, 34, 34);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:rgb(34, 34, 34);">控制不住激动的心情，下面我会通过示例马上给大家介绍此</span><span style="color:rgb(34, 34, 34);">API</span><span style="color:rgb(34, 34, 34);">的详细信息。</span></p><p><span style="color:rgb(34, 34, 34);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Google</span><span style="color:rgb(34, 34, 34);">专门提供了一个</span><a href="https://www.google.com/intl/en/chrome/demos/speech.html">原生示例</a><span style="color:rgb(34, 34, 34);">，来演示</span><span style="color:rgb(34, 34, 34);">Web Speech API</span><span style="color:rgb(34, 34, 34);">。</span></p><p style="text-align: center;"><span style="color:rgb(34, 34, 34);"><img src="http://namepk.sinaapp.com/blog/webSpeechAPI/1.jpg" alt=""><br></span></p><p align="left"><span style="color:#222222;"><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>我们来看看实现代码。首先需要判断浏览器是否支持</span><span style="color:rgb(34, 34, 34);">Web Speech API</span><span style="color:rgb(34, 34, 34);">，我们通过</span><span style="color:rgb(34, 34, 34);">window</span><span style="color:rgb(34, 34, 34);">下是否存在</span><span style="color:#cc0000;">webkitSpeechRecognition</span><span style="color:#222222;">对象来判断。</span><span style="color:#222222;">如果支持，我们创建</span><span style="color:#cc0000;">webkitSpeechRecognition</span><span style="color:#222222;">对象，并设置相关属性和事件。</span></p><p align="left"></p><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 506px; top: 938px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_1" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_1" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=1&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>if&nbsp;(!('webkitSpeechRecognition'&nbsp;in&nbsp;window))&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;upgrade();&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;else&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;var&nbsp;<span class="attribute">recognition</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">new</span><span>&nbsp;webkitSpeechRecognition();&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;<span class="attribute">recognition.continuous</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">true</span><span>;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;<span class="attribute">recognition.interimResults</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">true</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;<span class="attribute">recognition.onstart</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">function</span><span>()&nbsp;{&nbsp;...&nbsp;}&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;<span class="attribute">recognition.onresult</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">function</span><span>(event)&nbsp;{&nbsp;...&nbsp;}&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;<span class="attribute">recognition.onerror</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">function</span><span>(event)&nbsp;{&nbsp;...&nbsp;}&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;<span class="attribute">recognition.onend</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">function</span><span>()&nbsp;{&nbsp;...&nbsp;}&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;...&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">if (!('webkitSpeechRecognition' in window)) {
  upgrade();
} else {
  var recognition = new webkitSpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;

  recognition.onstart = function() { ... }
  recognition.onresult = function(event) { ... }
  recognition.onerror = function(event) { ... }
  recognition.onend = function() { ... }
  ...</pre><p><span style="color: rgb(34, 34, 34);"><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>continuous</span><span style="color: rgb(34, 34, 34);">属性</span><span style="color: rgb(34, 34, 34);">的默认值是</span><span style="color: rgb(34, 34, 34);">false</span><span style="color: rgb(34, 34, 34);">，代表当用户停止说话时，语音识别将结束。在这个</span><a href="https://www.google.com/intl/en/chrome/demos/speech.html"><span style="color:#508B88;">演示中</span></a><span style="color: rgb(34, 34, 34);">&nbsp;</span><span style="color: rgb(34, 34, 34);">，我们将它设置为</span><span style="color: rgb(34, 34, 34);">true</span><span style="color: rgb(34, 34, 34);">，这样即便用户暂时停止讲话，语音识别也将会继续。</span></p><p align="left"><span style="color:#222222;"><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>interimResults</span><span style="color:#222222;">属性的默认值也是</span><span style="color:#222222;">false</span><span style="color:#222222;">，代表语音识别器的返回值不会改变。在这个演示中，我们把它设置为</span><span style="color:#222222;">true</span><span style="color:#222222;">，这样随着我们的输入，识别结果有可能会改变。仔细观看演示，灰色的文字是临时性的，有时会改变，而黑色文本是最终结果，不会改变。</span></p><p align="left"><span style="color:#222222;"><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>当我们点击麦克风按钮时，会触发如下代码：</span></p><p align="left"><span style="color:#222222;"></span></p><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 506px; top: 1407px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_2" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_2" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=2&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span>function&nbsp;startButton(event)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;...&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;<span class="attribute">final_transcript</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">''</span><span>;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;<span class="attribute">recognition.lang</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">select_dialect</span><span>.value;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;recognition.start();&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">function startButton(event) {
  ...
  final_transcript = '';
  recognition.lang = select_dialect.value;
  recognition.start();</pre><p></p><p align="left"><span style="color: rgb(34, 34, 34);"><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>我们用</span><span style="color:#cc0000;">recognition.lang</span><span style="color: rgb(34, 34, 34);">来设置语音识别的语言，在这个示例中默认为</span><span style="color: rgb(34, 34, 34);">HTML</span><span style="color: rgb(34, 34, 34);">页面的语言，通过下拉列表用户可以进行更换，例如“</span><span style="color: rgb(34, 34, 34);">cmn-Hans-CN</span><span style="color: rgb(34, 34, 34);">”代表普通话，而“</span><span style="color: rgb(34, 34, 34);">en-us</span><span style="color: rgb(34, 34, 34);">”代表美式英语。</span><span style="color: rgb(34, 34, 34);">Chrome</span><span style="color: rgb(34, 34, 34);">浏览器的语音识别支持众多的语言，非常强大。</span></p><p align="left"><span style="color:#222222;"><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>设置语言后，我们调用</span><span style="color:#222222;">recognition.start()</span><span style="color:#222222;">来激活语音识别。一旦开始捕获音频，它调用</span><span style="color:#222222;">onstart</span><span style="color:#222222;">方法，然后为每一个新的结果集调用</span><span style="color:#222222;">onresult</span><span style="color:#222222;">方法进行处理。</span></p><p align="left"></p><div class="dp-highlighter bg_html"><div class="bar"><div class="tools"><b>[html]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 506px; top: 1710px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_3" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_3" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=3&amp;width=18&amp;height=18" wmode="transparent"></div></div></div><ol start="1" class="dp-xml"><li class="alt"><span><span class="attribute">recognition.onresult</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">function</span><span>(event)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;var&nbsp;<span class="attribute">interim_transcript</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">''</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;for&nbsp;(var&nbsp;<span class="attribute">i</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">event</span><span>.resultIndex;&nbsp;i&nbsp;</span><span class="tag">&lt;</span><span>&nbsp;</span><span class="tag-name">event.results.length</span><span>;&nbsp;++i)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(event.results[i].isFinal)&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final_transcript&nbsp;+=&nbsp;event.results[i][0].transcript;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interim_transcript&nbsp;+=&nbsp;event.results[i][0].transcript;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;<span class="attribute">final_transcript</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">capitalize</span><span>(final_transcript);&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;<span class="attribute">final_span.innerHTML</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">linebreak</span><span>(final_transcript);&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;<span class="attribute">interim_span.innerHTML</span><span>&nbsp;=&nbsp;</span><span class="attribute-value">linebreak</span><span>(interim_transcript);&nbsp;&nbsp;</span></span></li><li class=""><span>};&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="html" style="display: none;">  recognition.onresult = function(event) {
    var interim_transcript = '';

    for (var i = event.resultIndex; i &lt; event.results.length; ++i) {
      if (event.results[i].isFinal) {
        final_transcript += event.results[i][0].transcript;
      } else {
        interim_transcript += event.results[i][0].transcript;
      }
    }
    final_transcript = capitalize(final_transcript);
    final_span.innerHTML = linebreak(final_transcript);
    interim_span.innerHTML = linebreak(interim_transcript);
  };
}</pre><p></p><p align="left"><span style="color:#222222;"><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>这个</span><span style="color:#222222;">handler</span><span style="color:#222222;">把结果分成两个字符串：</span><span style="color:#222222;">final_transcript</span><span style="color:#222222;">和</span><span style="color:#222222;">interim_transcript</span><span style="color:#222222;">。这里调用</span><span style="color:#222222;">Linebreak</span><span style="color:#222222;">方法来进行分段。最后，它会将</span><span style="color:#222222;">final_transcript</span><span style="color:#222222;">设置为</span><span style="color:#222222;">final_span</span><span style="color:#222222;">的</span><span style="color:#222222;">innerHTML</span><span style="color:#222222;">，显示为</span><span style="color:#222222;">黑色；而将</span><span style="color:#222222;">interim_transcript</span><span style="color:#222222;">设置为</span><span style="color:#222222;">interim_span</span><span style="color:#222222;">的</span><span style="color:#222222;">innerHTML</span><span style="color:#222222;">，显示为</span><span style="color:#222222;">灰色</span><span style="color:#222222;">。</span></p><p align="left"><span style="color:#222222;"><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>以上就是功能核心代码。当</span><span style="color:#222222;">recognition.start()</span><span style="color:#222222;">被调用时，</span><span style="color:#222222;">麦克风识别动画开始显示，同时</span><span style="color:#222222;">Chrome</span><span style="color:#222222;">需要获得用户对麦克风的授权。有一点非常重要的是，</span><strong><span style="color:#222222;">HTTPS</span><span style="color:#222222;">网页不需要反复获取授权，而</span><span style="color:#222222;">HTTP</span></strong><span style="color:#222222;"><strong>网页需要</strong>。</span></p><p align="center"><img src="http://namepk.sinaapp.com/blog/webSpeechAPI/2.jpg" alt=""> </p><p align="left"><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>当开始语音输入、捕获和识别时，我们还会在桌面右下角看到相关提示。</p><p align="center"><img src="http://namepk.sinaapp.com/blog/webSpeechAPI/3.jpg" alt=""> </p><p align="center"><img src="http://namepk.sinaapp.com/blog/webSpeechAPI/4.jpg" alt=""><br></p><p align="center"> </p><p><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>从现在开始，Web App的开发者们可以好好考虑考虑，利用Web Speech API能够开发出什么样有趣的产品，或者为自己的产品添加什么有趣的功能？</p><p><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>提示：如果要体验文中的Demo，请使用Chrome 25以上的版本或者Chrome Canary。</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;相关文章：《<a href="http://blog.csdn.net/hfahe/article/details/7338032">对HTML5 Device API相关规范的解惑</a>》</p><p><span><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>参考文章：<a href="http://updates.html5rocks.com/2013/01/Voice-Driven-Web-Apps-Introduction-to-the-Web-Speech-API">VOICE DRIVEN WEB APPS: INTRODUCTION TO THE WEB SPEECH API</a></span></p><p><span style="color:rgb(51, 51, 51);"><span style="color: rgb(34, 34, 34);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>转载请标明出处：</span><span style="color:rgb(51, 102, 153);"><a href="http://blog.csdn.net/hfahe">蒋宇捷的专栏</a></span></p><p></p>
</div>



<!-- Baidu Button BEGIN -->
<div id="bdshare" class="bdshare_t bds_tools get-codes-bdshare" style="float: right;">
<a class="bds_qzone" title="分享到QQ空间" href="#"></a>
<a class="bds_tsina" title="分享到新浪微博" href="#"></a>
<a class="bds_tqq" title="分享到腾讯微博" href="#"></a>
<a class="bds_renren" title="分享到人人网" href="#"></a>
<a class="bds_t163" title="分享到网易微博" href="#"></a>
<span class="bds_more">更多</span>
<a class="shareCount" href="#" title="累计分享0次">0</a>
</div>
<!-- Baidu Button END -->


<!--192.168.100.33-->
<div class="article_next_prev">
            <li class="prev_article"><span>上一篇：</span><a href="/hfahe/article/details/8507643" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_shangyipian'])">HTML5安全攻防详析之完结篇：HTML5对安全的改进</a></li>
            <li class="next_article"><span>下一篇：</span><a href="/hfahe/article/details/8539579" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_xiayipian'])">Web滚动性能优化实战</a></li>
</div>

<!-- Baidu Button BEGIN -->


<!-- Baidu Button END -->

        <div id="digg" articleid="8511238">
            <dl id="btnDigg" class="digg digg_disable">
                <dt onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_ding'])">顶</dt>
                <dd>4</dd>
            </dl>
            <dl id="btnBury" class="digg digg_disable">
                <dt onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_cai'])">踩</dt>
                <dd>0</dd>
            </dl>
        </div>
</div>