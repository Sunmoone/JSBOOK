空间效果（AudioPannerNode）。主要是对维度空间的音频消散计算，包括声音方向、多普勒效应的计算等。


<div class="BlogEntity">		
      <div class="BlogTitle">
        <h1><span class="icon" style="background:#44ac57;" title="原创博客">原</span>															MIXING POSITIONAL AUDIO AND WEBGL 混合位置声音和WEBGL</h1>
        <div class="BlogStat">
    		    		发表于1年前(2012-05-11 01:31)&nbsp;&nbsp;
    		阅读（<span class="g">60</span>）&nbsp;|&nbsp;评论（<a href="#comments"><span class="g">0</span></a>）
    					    	    <span class="admin">
				<style>
#TagsSwitcher{color:#A00;}
#RecTags,#MyTags{margin:5px 0;}
#RecTags a.tag{line-height:24px;}
#favor_form p:first-child{margin:5px 0;}
#favor_form{width:200px;}
#favor_form p {color:#666;}
#favor_form form{min-height: 85px;width:200px;}
#favor_form form ._favor_input{display:block;margin:2px 0;width:199px;}
#favor_form form ._favor_button{float:left;padding:2px 5px;}
.favor_ok {text-align:center;font-size:10.5pt;width:199px;height:60px;margin-top:10px;}
#TagsSwitcher{cursor:pointer;float:right;margin-top:10px;}
#MyTags{display:none;width:199px;}
#MyTags a.tag {float:left; background-color: #E0EAF1;border-bottom: 1px solid #3E6D8E;border-right: 1px solid #7F9FB6;color: #3E6D8E;font-size: 8pt;line-height: 16px;margin: 2px 2px 2px 0;padding: 2px 4px;text-decoration: none;white-space: nowrap;}
#MyTags a.tag:hover{background-color: #3E6D8E;color: #FFF;}
</style>


<em id="p_attention_count">0</em>人收藏此文章,
<span id="attention_it">
	<a href="javascript:add_to_favor(56985,3)" id="favor_trigger" title="添加到收藏夹">我要收藏</a>
</span>			</span>
			    	</div>
		<div class="tvote" onclick="vote(56985)" title="都有0个人赞过了，你也来赞一下吧！不会扣积分哦！"><em class="vote">赞</em><em class="num vote_count">0</em></div>
      </div>
	  
	  <a name="kindeditor"></a>
	            <div class="BlogAbstracts">
						           <div class="BlogTags">
        	        	<a href="http://www.oschina.net/search?scope=blog&amp;q=javascript" class="tag">javascript</a>
        	        	<a href="http://www.oschina.net/search?scope=blog&amp;q=WebAudioAPI" class="tag">WebAudioAPI</a>
        	           </div>
		   		  </div><br>
	  	  	  <div class="BlogContent"><p>作者&nbsp;<strong><a href="http://www.html5rocks.com/profiles/#ilmari" rel="nofollow">Ilmari Heikkinen</a>&nbsp;</strong></p> 
<p><span style="color:#333333;font-family:'Open Sans', sans-serif;line-height:16px;">发表</span><span style="color:#333333;font-family:'Open Sans', sans-serif;line-height:16px;">&nbsp;</span><strong>Feb. 16, 2012</strong></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p>更新&nbsp;<strong>Feb. 28, 2012</strong></p> 
<h2></h2> 
<h2>浏览器支持:</h2> 
<span style="color:#333333;font-size:12px;float:left;margin-top:0px;margin-right:0.75em;margin-bottom:0px;margin-left:0.25em;font-weight:normal;line-height:14px;text-transform:none;"><span style="float:left;height:17px;width:17px;background-image:url(http://www.html5rocks.com/static/images/browser_logos.png);background-attachment:initial;background-origin:initial;background-clip:initial;background-color:transparent;opacity:0.25;margin-top:-1px;margin-right:0.25em;margin-bottom:0px;margin-left:0px;position:relative;background-position:-69px 0%;background-repeat:no-repeat no-repeat;"><span style="background-image:initial;background-attachment:initial;background-origin:initial;background-clip:initial;background-color:transparent;font-size:11px;line-height:1;padding-top:3px;padding-right:5px;padding-bottom:3px;padding-left:5px;position:absolute;top:-15px;left:-3px;opacity:0;text-align:center;text-transform:uppercase;-webkit-transition-property:all;-webkit-transition-duration:0.1s;-webkit-transition-timing-function:ease-in-out;-webkit-transition-delay:initial;display:inline-block;">OPERA</span></span><span style="float:left;height:17px;width:17px;background-image:url(http://www.html5rocks.com/static/images/browser_logos.png);background-attachment:initial;background-origin:initial;background-clip:initial;background-color:transparent;opacity:0.25;margin-top:-1px;margin-right:0.25em;margin-bottom:0px;margin-left:0px;position:relative;background-position:-52px 0%;background-repeat:no-repeat no-repeat;"><span style="background-image:initial;background-attachment:initial;background-origin:initial;background-clip:initial;background-color:transparent;font-size:11px;line-height:1;padding-top:3px;padding-right:5px;padding-bottom:3px;padding-left:5px;position:absolute;top:-15px;left:-3px;opacity:0;text-align:center;text-transform:uppercase;-webkit-transition-property:all;-webkit-transition-duration:0.1s;-webkit-transition-timing-function:ease-in-out;-webkit-transition-delay:initial;display:inline-block;width:106px;">INTERNET EXPLORER</span></span><span style="float:left;height:17px;width:17px;background-image:url(http://www.html5rocks.com/static/images/browser_logos.png);background-attachment:initial;background-origin:initial;background-clip:initial;background-color:transparent;opacity:1;margin-top:-1px;margin-right:0.25em;margin-bottom:0px;margin-left:0px;position:relative;background-position:-35px 0%;background-repeat:no-repeat no-repeat;"><span style="background-image:initial;background-attachment:initial;background-origin:initial;background-clip:initial;background-color:transparent;font-size:11px;line-height:1;padding-top:3px;padding-right:5px;padding-bottom:3px;padding-left:5px;position:absolute;top:-15px;left:-3px;opacity:0;text-align:center;text-transform:uppercase;-webkit-transition-property:all;-webkit-transition-duration:0.1s;-webkit-transition-timing-function:ease-in-out;-webkit-transition-delay:initial;display:inline-block;">SAFARI</span></span><span style="float:left;height:17px;width:17px;background-image:url(http://www.html5rocks.com/static/images/browser_logos.png);background-attachment:initial;background-origin:initial;background-clip:initial;background-color:transparent;opacity:0.25;margin-top:-1px;margin-right:0.25em;margin-bottom:0px;margin-left:0px;position:relative;background-position:-17px 0%;background-repeat:no-repeat no-repeat;"><span style="background-image:initial;background-attachment:initial;background-origin:initial;background-clip:initial;background-color:transparent;font-size:11px;line-height:1;padding-top:3px;padding-right:5px;padding-bottom:3px;padding-left:5px;position:absolute;top:-15px;left:-3px;opacity:0;text-align:center;text-transform:uppercase;-webkit-transition-property:all;-webkit-transition-duration:0.1s;-webkit-transition-timing-function:ease-in-out;-webkit-transition-delay:initial;display:inline-block;">FIREFOX</span></span><span style="float:left;height:17px;width:17px;background-image:url(http://www.html5rocks.com/static/images/browser_logos.png);background-attachment:initial;background-origin:initial;background-clip:initial;background-color:transparent;opacity:1;margin-top:-1px;margin-right:0.25em;margin-bottom:0px;margin-left:0px;position:relative;background-position:0% 0%;background-repeat:no-repeat no-repeat;"><span style="background-image:initial;background-attachment:initial;background-origin:initial;background-clip:initial;background-color:transparent;font-size:11px;line-height:1;padding-top:3px;padding-right:5px;padding-bottom:3px;padding-left:5px;position:absolute;top:-15px;left:-3px;opacity:0;text-align:center;text-transform:uppercase;-webkit-transition-property:all;-webkit-transition-duration:0.1s;-webkit-transition-timing-function:ease-in-out;-webkit-transition-delay:initial;display:inline-block;">CHROME</span></span></span> 
<p><span style="color:#008000;"><span style="font-size:12px;line-height:18px;"><br> </span></span></p> 
<p><span style="color:#008000;"><span style="font-size:12px;line-height:18px;color:#000000;">原文地址</span></span><a href="http://www.html5rocks.com/en/tutorials/webaudio/positional_audio/" rel="nofollow">http://www.html5rocks.com/en/tutorials/webaudio/positional_audio/</a>（PS：强烈建议看原文）</p> 
<p><span style="color:#008000;"><span style="font-size:12px;line-height:18px;color:#000000;">入门简介</span></span></p> 
<span style="color:#000000;"> </span> 
<p><span style="color:#008000;"><span style="font-size:12px;line-height:18px;color:#000000;">在这篇文章中我将讲解如何使用Web Audio API中的音频位置特性在WebGL场景中添加3D音频。为了使音频更加真实，我也会介绍给你使用Web Audio API实现的环境音效。想得到更多关于Web Audio API的介绍，移步Boris Smus的文章<a href="http://www.html5rocks.com/en/tutorials/webaudio/intro/" target="_blank" rel="nofollow"><span style="color:#000000;">Getting started with Web Audio API</span></a>。</span></span></p> 
<span style="color:#000000;"> </span> 
<p><span style="color:#008000;"><span style="font-size:12px;line-height:18px;color:#000000;">使用Web Audio API中的AudioPannerNode实现位置音效。AudioPannerNode定义了音频的位置、方向和速率。此外，Web Audio API中的context的listener属性能允许你定义声音接收方的位置、方向和速率。使用这两个特性就能够创建带有多普勒效应和3D移动效果的有方向声音。 </span></span></p> 
<span style="color:#000000;"> </span> 
<p><span style="color:#008000;"><span style="font-size:12px;line-height:18px;color:#000000;">下面是一个带平面音效的3D场景。很平淡。听起来没有任何声音特效。使用WASD或者箭头键移动，用鼠标拖动移动视角。</span></span></p> 
<p><a href="http://static.oschina.net/uploads/space/2012/0428/165923_JEpu_438206.png" target="_blank"><img src="http://static.oschina.net/uploads/space/2012/0428/165923_JEpu_438206.png" alt="" style="cursor: pointer;"></a><br> </p> 
<p>看一下上面场景的代码。很基础的Audio API代码。你需要创建一系列的Audio API节点然后将他们链接到一起。音频节点可以是单独的音频，音量控制器，特效节点和分析器之类的。建完这个图以后，你需要最终关联到这个音频容器的目的节点才能使他播放。</p> 
<p></p> 
<div id="highlighter_313808" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_313808_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_313808" menu="false" src="/js/syntax-highlighter-2.1.382/scripts/clipboard.swf"></div><a href="#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="comments">// Detect if the audio context is supported.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="plain">window.AudioContext = (</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">window.AudioContext ||</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">window.webkitAudioContext ||</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">null</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="keyword">if</code> <code class="plain">(!AudioContext) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">throw</code> <code class="keyword">new</code> <code class="plain">Error(</code><code class="string">"AudioContext not supported!"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="plain">} </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="comments">// Create a new audio context.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="keyword">var</code> <code class="plain">ctx = </code><code class="keyword">new</code> <code class="plain">AudioContext();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="comments">// Create a AudioGainNode to control the main volume.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="keyword">var</code> <code class="plain">mainVolume = ctx.createGainNode();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="comments">// Connect the main volume node to the context destination.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="plain">mainVolume.connect(ctx.destination);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="comments">// Create an object with a sound source and a volume control.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="keyword">var</code> <code class="plain">sound = {};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="plain">sound.source = ctx.createBufferSource();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="plain">sound.volume = ctx.createGainNode();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content"><code class="comments">// Connect the sound source to the volume control.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content"><code class="plain">sound.source.connect(sound.volume);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>27</code></td><td class="content"><code class="comments">// Hook up the sound volume control to the main volume.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>28</code></td><td class="content"><code class="plain">sound.volume.connect(mainVolume);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>29</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>30</code></td><td class="content"><code class="comments">// Make the sound source loop.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>31</code></td><td class="content"><code class="plain">sound.source.loop = </code><code class="keyword">true</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>32</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>33</code></td><td class="content"><code class="comments">// Load a sound file using an ArrayBuffer XMLHttpRequest.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>34</code></td><td class="content"><code class="keyword">var</code> <code class="plain">request = </code><code class="keyword">new</code> <code class="plain">XMLHttpRequest();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>35</code></td><td class="content"><code class="plain">request.open(</code><code class="string">"GET"</code><code class="plain">, soundFileName, </code><code class="keyword">true</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>36</code></td><td class="content"><code class="plain">request.responseType = </code><code class="string">"arraybuffer"</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>37</code></td><td class="content"><code class="plain">request.onload = </code><code class="keyword">function</code><code class="plain">(e) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>38</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>39</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Create a buffer from the response ArrayBuffer.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>40</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">buffer = ctx.createBuffer(</code><code class="keyword">this</code><code class="plain">.response, </code><code class="keyword">false</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>41</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">sound.buffer = buffer;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>42</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>43</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// Make the sound source use the buffer and start playing it.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>44</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">sound.source.buffer = sound.buffer;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>45</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">sound.source.noteOn(ctx.currentTime);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>46</code></td><td class="content"><code class="plain">};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>47</code></td><td class="content"><code class="plain">request.send();</code></td></tr></tbody></table></div></div></div> 
<p> </p> 
<p></p> 
<p>&nbsp;位置</p> 
<p>位置音频使用你音源的位置和接收声音方的位置决定如何混合音频最总传递给扬声器。一个在听声音者左边的音源应该使左边的扬声器声音更大点，反之亦然。</p> 
<p>首先，创建一个音源并将其绑定到一个AudioPannerNode上。设置AudioPannerNode的位置。着样就有了一个3D音效。音频环境的收听者的位置默认在(0,0,0)，用这种方式，AudioPannerNode的位置和摄像机位置是相对的。当移动摄像机位置是，就需要更新AudioPannerNode的位置。为了使AudioPannerNode的位置在场景上是相对的，需要更新音频环境的收听者的位置到摄像机的位置。</p> 
<p><a href="http://static.oschina.net/uploads/space/2012/0428/173839_YKhb_438206.png" target="_blank"><img src="http://static.oschina.net/uploads/space/2012/0428/173839_YKhb_438206.png" alt="" style="cursor: pointer;"></a></p> 
<p>&nbsp;为了建立起位置跟踪，我们需要创建一个AudioPannerNode并且将其串联进main volume中。</p> 
<p></p> 
<div id="highlighter_790147" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_790147_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_790147" menu="false" src="/js/syntax-highlighter-2.1.382/scripts/clipboard.swf"></div><a href="#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">sound.panner = ctx.createPanner();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="comments">// Instead of hooking up the volume to the main volume, hook it up to the panner.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">sound.volume.connect(sound.panner);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="comments">// And hook up the panner to the main volume.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="plain">sound.panner.connect(mainVolume);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div></div></div> 
<p> </p> 
<p> 在每个框架中，更新AudioPannerNode的位置。下面的例子里我使用的是Three.js 3D框架。</p> 
<p></p> 
<div id="highlighter_557769" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_557769_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_557769" menu="false" src="/js/syntax-highlighter-2.1.382/scripts/clipboard.swf"></div><a href="#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="comments">// In the frame handler function, get the object's position.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">object.position.set(newX, newY, newZ);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">object.updateMatrixWorld();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="keyword">var</code> <code class="plain">p = object.matrixWorld.getPosition();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="comments">// And copy the position over to the sound of the object.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="plain">sound.panner.setPosition(p.x, p.y, p.z);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div></div></div> 
<p></p> 
<p>为了能追踪到收听者的位置，设置音频环境中收听者的位置到和摄像机相同的位置。</p> 
<p></p> 
<div id="highlighter_359473" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_359473_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_359473" menu="false" src="/js/syntax-highlighter-2.1.382/scripts/clipboard.swf"></div><a href="#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="comments">// Get the camera position.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">camera.position.set(newX, newY, newZ);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">camera.updateMatrixWorld();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="keyword">var</code> <code class="plain">p = camera.matrixWorld.getPosition();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="comments">// And copy the position over to the listener.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="plain">ctx.listener.setPosition(p.x, p.y, p.z);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div></div></div> 
<p> </p> 速率 
<br> 
<p></p> 
<p>&nbsp;现在我们有了收听者的位置和AudioPannerNode的位置，现在把注意力放到他们的速率上。通过改变收听者和AudioPannerNode的速率特性，就能够给声音加上多普勒效应。这里有一些不错的基于WebAudioAPI的多普勒效应例子<a href="http://chromium.googlecode.com/svn/trunk/samples/audio/index.html" rel="nofollow">examples page</a>。</p> 
<p></p> 
<p>&nbsp;PS：示例见源文。</p> 
<p>通过获取object的位置可以追踪到其速率，用当前帧的位置减去上一帧的位置并除以这之间所用的时间。下面是用Three.js的实现：</p> 
<p></p> 
<div id="highlighter_159008" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_159008_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_159008" menu="false" src="/js/syntax-highlighter-2.1.382/scripts/clipboard.swf"></div><a href="#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="keyword">var</code> <code class="plain">dt = secondsSinceLastFrame;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="keyword">var</code> <code class="plain">p = object.matrixWorld.getPosition();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="keyword">var</code> <code class="plain">px = p.x, py = p.y, pz = p.z;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="plain">object.position.set(newX, newY, newZ);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="plain">object.updateMatrixWorld();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="keyword">var</code> <code class="plain">q = object.matrixWorld.getPosition();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="keyword">var</code> <code class="plain">dx = q.x-px, dy = q.y-py, dz = q.z-pz;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="plain">sound.panner.setPosition(q.x, q.y, q.z);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="plain">sound.panner.setVelocity(dx/dt, dy/dt, dz/dt);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div></div></div> 
<p> </p> 方向 
<p></p> 
<p>放向就是声音的播放方向以及收听者面向的方向。使用方向可以模拟出带有方向性的音源。例如，朝着一个方向说话的人。如果你站着他前面，听到的声音比站着他后面听到的声音大。更重要的是，你可以通过声音的方向判断声音冲你那边传来。当你转身时，从左边穿来的声音会变成从右边传来。</p> 
<p>建立一个AudioPannerNode的方向矢量，你需要有3D声音模型的角度矩阵，并且将它乘以一个vec3(0,0,1)来的得到最终指向。对于声音环境的收听者的方向，需要获得摄像机的方向向量。收听者的方向还需要一个向上的适量，因为需要知道收听者的侧倾角。计算收听者方向的方法是，用摄像机的方向矩阵乘以vec3(0,0,1)，在为向上矩阵乘以一个vec3(0,-1,0)。</p> 
<p>为了让声音有方向特效，还需要给声音定义一个圆锥体。这个声音圆锥体包含一个内圆角，外角和外角之外的声音。内角度播放正常的声音，声音从内角到外角逐渐变小。外角意外播放外角之外的声音。</p> 
<p>示例：略。</p> 
<p>在threejs中追踪方向需要一点小技巧，因为它包含许多向量运算和将4*4矩阵归零。</p> 
<p></p> 
<div id="highlighter_584237" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_584237_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_584237" menu="false" src="/js/syntax-highlighter-2.1.382/scripts/clipboard.swf"></div><a href="#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="keyword">var</code> <code class="plain">vec = </code><code class="keyword">new</code> <code class="plain">THREE.Vector3(0,0,1);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="keyword">var</code> <code class="plain">m = object.matrixWorld;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="comments">// Save the translation column and zero it.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="keyword">var</code> <code class="plain">mx = m.n14, my = m.n24, mz = m.n34;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="plain">m.n14 = m.n24 = m.n34 = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="comments">// Multiply the 0,0,1 vector by the world matrix and normalize the result.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="plain">m.multiplyVector3(vec);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="plain">vec.normalize();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="plain">sound.panner.setOrientation(vec.x, vec.y, vec.z);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="comments">// Restore the translation column.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="plain">m.n14 = mx;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="plain">m.n24 = my; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="plain">m.n34 = mz;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div></div></div> 
<p> </p> 摄像机方向追踪也需要向上矢量，所以需要乘以一个向上矢量到装换矩阵上。 
<p></p> 
<p></p> 
<div id="highlighter_245884" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_245884_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_245884" menu="false" src="/js/syntax-highlighter-2.1.382/scripts/clipboard.swf"></div><a href="#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="comments">// The camera's world matrix is named "matrix".</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="keyword">var</code> <code class="plain">m = camera.matrix;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="keyword">var</code> <code class="plain">mx = m.n14, my = m.n24, mz = m.n34;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="plain">m.n14 = m.n24 = m.n34 = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="comments">// Multiply the orientation vector by the world matrix of the camera.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="keyword">var</code> <code class="plain">vec = </code><code class="keyword">new</code> <code class="plain">THREE.Vector3(0,0,1);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="plain">m.multiplyVector3(vec);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="plain">vec.normalize();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="comments">// Multiply the up vector by the world matrix.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="keyword">var</code> <code class="plain">up = </code><code class="keyword">new</code> <code class="plain">THREE.Vector3(0,-1,0);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="plain">m.multiplyVector3(up);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="plain">up.normalize();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="comments">// Set the orientation and the up-vector for the listener.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="plain">ctx.listener.setOrientation(vec.x, vec.y, vec.z, up.x, up.y, up.z);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="plain">m.n14 = mx;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="plain">m.n24 = my; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="plain">m.n34 = mz;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div></div></div> 
<p> </p> 给你的声音设置声音圆锥体，给pannerNode设置适当的属性。圆锥角度从0到360度。 
<p></p> 
<p></p> 
<div id="highlighter_945457" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_945457_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_945457" menu="false" src="/js/syntax-highlighter-2.1.382/scripts/clipboard.swf"></div><a href="#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">sound.panner.coneInnerAngle = innerAngleInDegrees;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">sound.panner.coneOuterAngle = outerAngleInDegrees;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">sound.panner.coneOuterGain = outerGainFactor;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div></div></div> 
<p> </p> 合并 
<p></p> 
<p>将所有节点合并，声音环境收听者接位置节点、方向节点、摄像机速度节点，以及<span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">AudioPannerNodes接位置、方向、各自音源的速率节点。你需要每帧都更新更新AudioPannerNodes和声音环境中的收听者的位置、速率和方向。</span></p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">一个集合以上所有个性的示例：略</span></p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">环境特效</span></p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">当你建立起有位置的声音后，可以给你的声音加上换进特效以增强3D感。想想你的场景在一个大教堂。默认设置下，你的场景的声音让你感觉是在户外。这种视觉上和听觉上的差异会是你的场景不那么生动缺少感染力。</span></p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">WebAudioAPI中的AonvolverNode用来设置环境特效。将它加入音源的加工图里，就能够让声音符合设置了。你可以再网上找到使用ConvolverNodes的脉冲响应样品，或者也可以自己做一个。这可能有些比较繁琐的经验当你需要记录你希望的脉冲乡音方式，但是如果你需要它们威力无穷。</span></p> 
<p><span style="color:#222222;font-family:''Open Sans', sans-serif';"><span style="font-size:14px;line-height:21px;">一下例子，你可以切换不同的环境特效。</span></span></p> 
<p><span style="color:#222222;font-family:''Open Sans', sans-serif';"><span style="font-size:14px;line-height:21px;">示例：略</span></span></p> 
<p><span style="color:#222222;font-family:''Open Sans', sans-serif';"><span style="font-size:14px;line-height:21px;">使用ConvlverNodes到环境音效需要从新修改你的声音处理图。你需要通过ConvolverNode路由音源，取代之前直接将处理后的声音连接到主容器上。同时，你想要控制环境特效的强度，同样要通过</span></span><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">ConvolverNode路由。为了将ConvolverNode混合到原来的声音上，就得需要加上GainNodes。</span></p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">我最终的声音处理图使用了以GainNode做混合器的声音。在混合器前，我将声音加入到ConvolerNode和其他控制音量等GainNode。ConvolverNode连接到他自己的GainNode上以控制混合强度。GainNode的输出连接到主音量控制节点上。</span></p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;"></span></p> 
<div id="highlighter_314172" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_314172_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_314172" menu="false" src="/js/syntax-highlighter-2.1.382/scripts/clipboard.swf"></div><a href="#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="keyword">var</code> <code class="plain">ctx = </code><code class="keyword">new</code> <code class="plain">webkitAudioContext();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="keyword">var</code> <code class="plain">mainVolume = ctx.createGainNode();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="comments">// Create a convolver to apply environmental effects to the audio.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="keyword">var</code> <code class="plain">convolver = ctx.createConvolver();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="comments">// Create a mixer that receives sound from the panners.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="keyword">var</code> <code class="plain">mixer = ctx.createGainNode();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="plain">sounds.forEach(</code><code class="keyword">function</code><code class="plain">(sound){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">sound.panner.connect(mixer);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="plain">});</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="comments">// Create volume controllers for the plain audio and the convolver.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="keyword">var</code> <code class="plain">plainGain = ctx.createGainNode();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="keyword">var</code> <code class="plain">convolverGain = ctx.createGainNode();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="comments">// Send audio from the mixer to plainGain and the convolver node.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="plain">mixer.connect(plainGain);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="plain">mixer.connect(convolver);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="comments">// Hook up the convolver to its volume control.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content"><code class="plain">convolver.connect(convolverGain);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content"><code class="comments">// Send audio from the volume controls to the main volume control.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>27</code></td><td class="content"><code class="plain">plainGain.connect(mainVolume);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>28</code></td><td class="content"><code class="plain">convolverGain.connect(mainVolume);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>29</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>30</code></td><td class="content"><code class="comments">// Finally, connect the main volume to the audio context's destination.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>31</code></td><td class="content"><code class="plain">volume.connect(ctx.destination);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>32</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div></div></div> 
<p> </p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">为了使ConvolerNode工作，你需要加载脉冲响应示例到缓冲中，并让</span><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">ConvolerNode使用它。加载示例发生在同正常声音示例同样的途径。下面是一个例子：</span></p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;"></span></p> 
<div id="highlighter_229989" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_229989_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_229989" menu="false" src="/js/syntax-highlighter-2.1.382/scripts/clipboard.swf"></div><a href="#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="plain">loadBuffer(ctx, </code><code class="string">"impulseResponseExample.wav"</code><code class="plain">, </code><code class="keyword">function</code><code class="plain">(buffer){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">convolver.buffer = buffer;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">convolverGain.gain.value = 0.7;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">plainGain.gain.value = 0.3;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="plain">})</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="keyword">function</code> <code class="plain">loadBuffer(ctx, filename, callback) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">request = </code><code class="keyword">new</code> <code class="plain">XMLHttpRequest();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">request.open(</code><code class="string">"GET"</code><code class="plain">, soundFileName, </code><code class="keyword">true</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">request.responseType = </code><code class="string">"arraybuffer"</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">request.onload = </code><code class="keyword">function</code><code class="plain">() {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// Create a buffer and keep the channels unchanged.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">var</code> <code class="plain">buffer = ctx.createBuffer(request.response, </code><code class="keyword">false</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">callback(buffer);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">request.send();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div> 
<p> </p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">概要</span></p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">这篇文章中你能学到如何使用WebAudioAPI将声音的位置增加到你的3D场景中。WebAudioAPI提供给你方法去设置位置，方向，音源速率和收听者。通过设置这些跟踪到你的3D场景的对象上，你可以建立一个有丰富音效的3D应用。</span></p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">是声音体验更吸引人，你还能使用WebAudioAPI中的ConvolerNode设置一般的环境特效。从教堂到封闭的房间，你可以使用WebAudioAPI模拟一系列环境特效。</span></p> 
<p><span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:21px;">参考文献</span></p> 
<p></p> 
<ul> 
 <li><a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html" rel="nofollow">Web Audio API specification</a></li> 
 <li><a href="http://en.wikipedia.org/wiki/Impulse_response" rel="nofollow">Impulse response</a></li> 
 <li><a href="https://github.com/mrdoob/three.js" rel="nofollow">Three.js</a></li> 
 <li><a href="http://apps.playcanvas.com/dave/tutorials/3d_audio" rel="nofollow">A cool 3D Positional Audio example</a></li> 
 <li><a href="http://chromium.googlecode.com/svn/trunk/samples/audio/index.html" rel="nofollow">Web Audio Examples</a>&nbsp;有很多使用&nbsp;Web Audio API特性的好例子。</li> 
</ul> 
<div> 
 <span style="color:#222222;font-family:''Open Sans', sans-serif';"><span style="font-size:14px;line-height:22px;">（PS：第一次试着翻译英语文摘，个人水平实在有限，错误很多，</span></span> 
 <span style="color:#222222;font-family:'Open Sans', sans-serif;font-size:14px;line-height:22px;">望海涵，</span> 
 <span style="font-size:14px;line-height:22px;color:#222222;font-family:'Open Sans', sans-serif;">还希望您的帮助共同将错误修改，大家共同学习进步，谢谢。）</span> 
</div> 
<p></p> 
<p></p> 
<p></p> 
<p> </p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p></div>
      	      	<div class="BlogShare">
    	
		<strong>分享到：</strong>
		<a class="share_sina" title="分享到新浪微博" href="javascript:void((function(s,d,e,r,l,p,t,z,c){var%20f='http://v.t.sina.com.cn/share/share.php?appkey=858381728',u=z||d.location,p=['&url=',e(u),'&title=',e(t||d.title),'&source=',e(r),'&sourceUrl=',e(l),'&content=',c||'gb2312','&pic=',e(p||'')].join('');function%20a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=440,height=430,left=',(s.width-440)/2,',top=',(s.height-430)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();})(screen,document,encodeURIComponent,'','','','MIXING POSITIONAL AUDIO AND WEBGL 混合位置声音和WEBGL: 作者 Ilmari Heikkinen  发表 Feb. 16, 2012 更新 Feb. 28, 2012 浏览器支持: OPERAINTERNET EXPLORERSAFARIFIREFOXCHROME 原文地址http://www.html5rocks.com/en/...','','utf-8'));">
			<img src="/img/sinaweibo_fb1.png" height="29">
		</a>
		<a class="share_qq" title="分享到腾讯微博" href="javascript:(function(){window.open('http://v.t.qq.com/share/share.php?url='+encodeURIComponent(document.location)+'&appkey=96f54f97c4de46e393c4835a266207f4&site=&title='+encodeURIComponent(document.title)+encodeURIComponent(': 作者 Ilmari Heikkinen  发表 Feb. 16, 2012 更新 Feb. 28, 2012 浏览器支持: OPERAINTERNET EXPLORERSAFARIFIREFOXCHROME 原文地址http://www.html5rocks.com/en/...'),'', 'width=450, height=400, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, location=yes, resizable=no, status=no');}())">
			<img src="/img/tencent_weibo_fb.jpg" height="30">
		</a>
    	<span class="BlogVote" onclick="vote(56985)" title="都有0个人赞过了，你也来赞一下吧！不会扣积分哦！">
			<span class="num vote_count">0</span><span class="vote">赞</span>
		</span>
	</div>
      
      <div class="BlogCopyright">		
	  		声明：OSCHINA 博客文章版权属于作者，受法律保护。未经作者同意不得转载。
	  	  </div>
	  	  
      <div class="BlogLinks">
    	<ul>
                        <li class="next"><a href="http://my.oschina.net/TMDJoJo/blog/64849" title="下一篇：Java基本数据类型及类型转换">下一篇 »</a></li>    	</ul>
				<p style="margin:10px 0 0 0;font-weight:bold;color:#A00;text-decoration:none;">开源中国-程序员在线工具：<a href="http://www.ostools.net/apidocs" style="text-decoration:none;">API文档大全(120+)</a> <a href="http://runjs.cn" style="text-decoration:none;" target="_blank">JS在线编辑演示</a> <a href="http://www.ostools.net/qr" style="text-decoration:none;" target="_blank">二维码</a>  <a href="http://www.ostools.net" style="text-decoration:none;" target="_blank">更多&gt;&gt;</a>
		      </p></div>
	</div>